<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ¢ãƒ•é€²åŒ–DX -Ultimate Custom-</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@900&display=swap');
        :root { --main: #6d4c41; --sub: #d7ccc8; --pink: #ff8a80; --orange: #ffb74d; --blue: #81d4fa; --purple: #b39ddb; --gold: #ffd700; --heart: #f44336; --green: #81c784; }
        body { margin: 0; height: 100vh; overflow: hidden; background: #fffcf5; font-family: 'Zen Maru Gothic', sans-serif; touch-action: none; transition: background 1.5s; }
        
        /* 5ã¤ã®ãƒãƒ¼ã‚’ã‚¹ãƒƒã‚­ãƒªé…ç½® */
        .ui-header { position: fixed; top: 10px; left: 10px; z-index: 100; pointer-events: none; }
        .status-box { background: rgba(255,255,255,0.95); padding: 12px; border-radius: 20px; border: 3px solid var(--sub); pointer-events: auto; width: 170px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .status-row { display: flex; align-items: center; gap: 5px; margin-bottom: 3px; font-size: 11px; font-weight: 900; }
        .bar-bg { flex-grow: 1; height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
        .bar-fill { height: 100%; transition: 0.5s; }
        
        .lv-area { position: fixed; top: 15px; right: 15px; z-index: 100; }
        .lv-circle-box { width: 80px; height: 80px; background: white; border-radius: 50%; border: 5px solid var(--gold); display: flex; align-items: center; justify-content: center; flex-direction: column; }
        
        #mofu-container { position: absolute; transition: left 2.5s, top 2.5s; display: flex; flex-direction: column; align-items: center; z-index: 50; }
        .mofu-body { width: 140px; height: 130px; background: #fff; border-radius: 50% 50% 48% 48%; border: 6px solid var(--sub); display: flex; justify-content: center; align-items: center; position: relative; cursor: pointer; }
        
        /* é‡ã­ç€ã‚¹ãƒ­ãƒƒãƒˆ */
        .slot { position: absolute; font-size: 50px; pointer-events: none; }
        .slot-head { top: -45px; }
        .slot-face { top: 10px; }
        .slot-body { bottom: -20px; }
        .slot-hand { right: -30px; top: 50px; }

        .menu { position: fixed; bottom: 15px; width: 100%; display: flex; justify-content: center; flex-wrap: wrap; gap: 6px; z-index: 110; }
        .btn { padding: 10px 14px; border-radius: 15px; border: none; background: white; font-weight: 900; border-bottom: 4px solid var(--sub); cursor: pointer; font-family: inherit; font-size: 13px; }
        .sheet { position: fixed; bottom: -100%; left: 0; width: 100%; height: 85%; background: white; border-radius: 40px 40px 0 0; border-top: 8px solid var(--sub); z-index: 400; transition: 0.4s; padding: 25px; box-sizing: border-box; overflow-y: auto; }
        .sheet.open { bottom: 0; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .fade { position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; z-index:350; }
        
        #game-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; }
    </style>
</head>
<body>

<div id="start-screen" style="position:fixed; inset:0; background:white; z-index:3000; display:flex; flex-direction:column; align-items:center; justify-content:center;">
    <h2 style="color:var(--orange);">ãƒ¢ãƒ•é€²åŒ–DX</h2>
    <input type="text" id="un-in" style="padding:15px; margin:5px; border-radius:15px; border:3px solid var(--sub); width:70%;" placeholder="ãã¿ã®ãªã¾ãˆ">
    <input type="text" id="pn-in" style="padding:15px; margin:5px; border-radius:15px; border:3px solid var(--sub); width:70%;" placeholder="ãƒ¢ãƒ•ã®ãªã¾ãˆ">
    <button class="btn" style="background:var(--orange); color:white; width:70%;" onclick="startGame()">å†’é™ºé–‹å§‹ï¼</button>
</div>

<div class="ui-header">
    <div class="status-box">
        <div class="status-row">ğŸ’–<div class="bar-bg"><div id="b-kizuna" class="bar-fill" style="background:var(--heart);"></div></div></div>
        <div class="status-row">âš¡<div class="bar-bg"><div id="b-hp" class="bar-fill" style="background:var(--blue);"></div></div></div>
        <div class="status-row">ğŸ™<div class="bar-bg"><div id="b-food" class="bar-fill" style="background:var(--orange);"></div></div></div>
        <div class="status-row">ğŸ§¼<div class="bar-bg"><div id="b-clean" class="bar-fill" style="background:var(--green);"></div></div></div>
        <div class="status-row">ğŸ’¤<div class="bar-bg"><div id="b-sleep" class="bar-fill" style="background:var(--purple);"></div></div></div>
        <div style="font-weight:900; margin-top:5px; font-size:15px;">ğŸ’° <span id="coin">0</span></div>
    </div>
</div>

<div class="lv-area"><div class="lv-circle-box"><div style="font-size:10px;">Lv</div><div id="v-lvl" style="font-size:28px; font-weight:900;">1</div></div></div>

<div id="mofu-container">
    <div id="speech" style="position: absolute; top: -100px; background: white; border: 3px solid var(--main); padding: 8px; border-radius: 15px; opacity: 0; transition: 0.3s; font-weight: 900; white-space: nowrap;"></div>
    <div id="s-head" class="slot slot-head"></div>
    <div id="s-face" class="slot slot-face"></div>
    <div id="s-body" class="slot slot-body"></div>
    <div id="s-hand" class="slot slot-hand"></div>
    <div id="my-mofu" class="mofu-body" onclick="petMofu()">
        <div id="my-face" style="font-size:40px;">ãƒ»â©Šãƒ»</div>
    </div>
    <h3 id="mofu-name-display" style="background:white; padding:2px 10px; border-radius:10px; border:2px solid var(--sub); margin-top:5px;"></h3>
</div>

<div class="menu">
    <button class="btn" onclick="openSheet('care-sheet')">âœ¨ ãŠä¸–è©±</button>
    <button class="btn" onclick="openSheet('work-sheet')">âš’ï¸ ãƒã‚¤ãƒˆ</button>
    <button class="btn" onclick="openSheet('shop-sheet')">ğŸ›’ ã‚·ãƒ§ãƒƒãƒ—</button>
    <button class="btn" onclick="openSheet('locker-sheet')">ğŸ“¦ ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ</button>
    <button class="btn" onclick="openSheet('comm-sheet')">ğŸ“¶ é€šä¿¡</button>
    <button class="btn" onclick="resetGame()" style="background:#ff8a80; color:white;">ğŸ”„</button>
</div>

<div id="comm-sheet" class="sheet">
    <h3>ğŸ“¶ é€šä¿¡ãƒ¢ãƒ¼ãƒ‰</h3><hr>
    <p>ãƒã‚¤ID: <span id="my-id" style="font-family:monospace; background:#eee; padding:5px;">ç™ºè¡Œä¸­...</span></p>
    <input type="text" id="peer-id-input" style="width:100%; padding:10px; margin:10px 0;" placeholder="ç›¸æ‰‹ã®IDã‚’å…¥åŠ›">
    <button class="btn" style="width:100%; background:var(--blue); color:white;" onclick="connectToPeer()">ã¤ãªãŒã‚‹ï¼</button>
    <button class="btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">é–‰ã˜ã‚‹</button>
</div>

<div id="care-sheet" class="sheet"><h3>âœ¨ ãŠä¸–è©±</h3><hr><div class="grid" id="care-list"></div><button class="btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">æˆ»ã‚‹</button></div>
<div id="shop-sheet" class="sheet"><h3>ğŸ›’ ã‚·ãƒ§ãƒƒãƒ—</h3><hr><div class="grid" id="shop-list"></div><button class="btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">æˆ»ã‚‹</button></div>
<div id="work-sheet" class="sheet"><h3>âš’ï¸ ãƒã‚¤ãƒˆ</h3><hr><div class="grid" id="work-list"></div><button class="btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">æˆ»ã‚‹</button></div>
<div id="locker-sheet" class="sheet"><h3>ğŸ“¦ ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ</h3><hr><div class="grid" id="locker-list"></div><button class="btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">æˆ»ã‚‹</button></div>
<div id="dark-fade" class="fade" onclick="closeSheet()"></div>

<script>
    let d = JSON.parse(localStorage.getItem('mofu_v5')) || { 
        un:"", pn:"", cn:100, lvl:1, exp:0, hp:100, food:100, clean:100, sleep:100, kizuna:0, 
        items:[], eq:{head:"", face:"", body:"", hand:""} 
    };

    const shopItems = [
        {n:"ğŸã‚Šã‚“ã”", p:10, t:"food", v:20}, {n:"ğŸ–ãŠè‚‰", p:30, t:"food", v:50}, {n:"ğŸ°ã‚±ãƒ¼ã‚­", p:100, t:"food", v:100},
        {n:"ğŸ§¼çŸ³é¹¸", p:20, t:"clean", v:40}, {n:"ğŸ§´ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼", p:50, t:"clean", v:80},
        {n:"ğŸ‘‘ç‹å† ", p:500, t:"head", e:"ğŸ‘‘"}, {n:"ğŸ€ãƒªãƒœãƒ³", p:100, t:"head", e:"ğŸ€"},
        {n:"ğŸ•¶ã‚µãƒ³ã‚°ãƒ©ã‚¹", p:150, t:"face", e:"ğŸ•¶"}, {n:"ğŸ˜·ãƒã‚¹ã‚¯", p:50, t:"face", e:"ğŸ˜·"},
        {n:"ğŸ‘•ã‚·ãƒ£ãƒ„", p:200, t:"body", e:"ğŸ‘•"}, {n:"ğŸ‘˜ã‚­ãƒ¢ãƒ", p:800, t:"body", e:"ğŸ‘˜"},
        {n:"ğŸ—¡å‰£", p:1000, t:"hand", e:"ğŸ—¡"}, {n:"ğŸª„ã‚¹ãƒ†ãƒƒã‚­", p:600, t:"hand", e:"ğŸª„"}
    ];

    function saveData() { localStorage.setItem('mofu_v5', JSON.stringify(d)); }

    function startGame() {
        if(!d.un) {
            d.un = document.getElementById('un-in').value || "ã„ã£ãã‚“";
            d.pn = document.getElementById('pn-in').value || "ãƒ¢ãƒ•";
        }
        document.getElementById('start-screen').style.display='none';
        document.getElementById('mofu-name-display').innerText = d.pn;
        initPeer(); updateUI(); startWalking();
    }
    if(d.un) startGame();

    function updateUI() {
        document.getElementById('coin').innerText = d.cn;
        document.getElementById('v-lvl').innerText = d.lvl;
        document.getElementById('b-kizuna').style.width = d.kizuna + "%";
        document.getElementById('b-hp').style.width = d.hp + "%";
        document.getElementById('b-food').style.width = d.food + "%";
        document.getElementById('b-clean').style.width = d.clean + "%";
        document.getElementById('b-sleep').style.width = d.sleep + "%";
        
        document.getElementById('s-head').innerText = d.eq.head;
        document.getElementById('s-face').innerText = d.eq.face;
        document.getElementById('s-body').innerText = d.eq.body;
        document.getElementById('s-hand').innerText = d.eq.hand;
        
        saveData(); updateLists();
    }

    function updateLists() {
        const sl = document.getElementById('shop-list'); sl.innerHTML="";
        shopItems.forEach(i => {
            const b = document.createElement('button'); b.className='btn';
            b.innerHTML = `${i.n}<br>ğŸ’°${i.p}`;
            b.onclick = () => {
                if(d.cn < i.p) return alert("ãŠé‡‘ãŒè¶³ã‚Šãªã„ï¼");
                d.cn -= i.p;
                if(i.t === "food" || i.t === "clean") { d[i.t] = Math.min(100, d[i.t]+i.v); say(i.n + "æœ€é«˜ï¼"); }
                else { d.items.push(i); alert(i.n + "ã‚’è²·ã£ãŸï¼ãƒ­ãƒƒã‚«ãƒ¼ã‚’è¦‹ã¦ã­ã€‚"); }
                updateUI();
            };
            sl.appendChild(b);
        });

        const ll = document.getElementById('locker-list'); ll.innerHTML="";
        d.items.forEach((i, idx) => {
            const b = document.createElement('button'); b.className='btn';
            b.innerText = i.n;
            b.onclick = () => { d.eq[i.t] = i.e; updateUI(); say("ä¼¼åˆã†ã‹ãªï¼Ÿ"); };
            ll.appendChild(b);
        });

        const wl = document.getElementById('work-list'); wl.innerHTML="";
        [{n:"ğŸ§¹æƒé™¤", m:50, lv:1}, {n:"ğŸ“¦é…é”", m:150, lv:3}, {n:"ğŸš€å†’é™º", m:500, lv:10}].forEach(w => {
            const b = document.createElement('button'); b.className='btn';
            b.innerHTML = `${w.n}<br>ğŸ’°${w.m} (Lv${w.lv})`;
            if(d.lvl < w.lv) b.disabled = true;
            b.onclick = () => { d.cn += w.m; d.hp -= 20; d.exp += 20; checkLv(); updateUI(); say(w.n + "å®Œäº†ï¼"); closeSheet(); };
            wl.appendChild(b);
        });

        const cl = document.getElementById('care-list'); cl.innerHTML="";
        [{n:"ğŸ›Œå¯ã‚‹", v:50}, {n:"ğŸ¾éŠã¶", v:10}].forEach(c => {
            const b = document.createElement('button'); b.className='btn'; b.innerText=c.n;
            b.onclick = () => { if(c.n==="ğŸ›Œå¯ã‚‹") d.sleep=Math.min(100, d.sleep+50); else d.kizuna=Math.min(100, d.kizuna+10); updateUI(); closeSheet(); };
            cl.appendChild(b);
        });
    }

    function petMofu() { d.kizuna = Math.min(100, d.kizuna+1); d.exp += 2; say(d.un + "ã€ã ã„ã™ãï¼"); checkLv(); updateUI(); }
    function checkLv() { if(d.exp >= d.lvl*50) { d.lvl++; d.exp=0; alert("ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼"); updateUI(); } }
    function say(t) { const s=document.getElementById('speech'); s.innerText=t; s.style.opacity=1; setTimeout(()=>s.style.opacity=0, 2000); }
    function openSheet(id) { document.getElementById(id).classList.add('open'); document.getElementById('dark-fade').style.display='block'; }
    function closeSheet() { document.querySelectorAll('.sheet').forEach(s=>s.classList.remove('open')); document.getElementById('dark-fade').style.display='none'; }
    function resetGame() { if(confirm("æ¶ˆã™ï¼Ÿ")) { localStorage.clear(); location.reload(); } }
    function startWalking() { setInterval(() => { const c = document.getElementById('mofu-container'); c.style.left = Math.random()*(window.innerWidth-150)+'px'; c.style.top = Math.random()*(window.innerHeight-300)+100+'px'; }, 5000); }

    function initPeer() {
        const peer = new Peer();
        peer.on('open', id => document.getElementById('my-id').innerText = id);
        peer.on('connection', conn => { conn.on('data', data => alert("é€šä¿¡å—ä¿¡: " + data)); });
    }
    function connectToPeer() {
        const id = document.getElementById('peer-id-input').value;
        alert(id + "ã«æ¥ç¶šä¸­...ï¼ˆå®Œæˆç‰ˆã§ã¯ã“ã“ã‹ã‚‰å¯¾æˆ¦ã‚„äº¤æ›ãŒã§ãã‚‹ã‚ˆï¼ï¼‰");
    }
</script>
</body>
</html>
