<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ¢ãƒ•é€²åŒ–DX -THE REAL-</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@900&display=swap');
        :root { --main: #5d4037; --sub: #efebe9; --pink: #ff80ab; --orange: #ffb74d; --blue: #4fc3f7; --green: #81c784; --purple: #b39ddb; }
        body { margin: 0; height: 100vh; overflow: hidden; background: #fffdf0; font-family: 'Zen Maru Gothic', sans-serif; touch-action: none; user-select: none; }

        /* --- UIãƒ¬ã‚¤ãƒ¤ãƒ¼ --- */
        .status-canvas { position: fixed; top: 10px; left: 10px; z-index: 1000; width: 180px; background: rgba(255,255,255,0.9); padding: 10px; border-radius: 20px; border: 3px solid var(--sub); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .bar-wrap { margin-bottom: 6px; }
        .bar-info { display: flex; justify-content: space-between; font-size: 10px; font-weight: 900; margin-bottom: 2px; }
        .bar-bg { width: 100%; height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
        .bar-fill { height: 100%; width: 50%; transition: width 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        .coin-display { position: fixed; top: 15px; right: 90px; background: white; padding: 5px 15px; border-radius: 20px; border: 3px solid gold; font-weight: 900; color: #f57c00; z-index: 1000; }
        .lv-badge { position: fixed; top: 10px; right: 10px; width: 65px; height: 65px; background: white; border: 4px solid #ff5252; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        /* --- ãƒ¢ãƒ•æœ¬ä½“ï¼ˆç©¶æ¥µã‚¢ãƒ‹ãƒ¡ï¼‰ --- */
        #mofu-world { position: absolute; inset: 0; }
        #mofu-container { position: absolute; width: 180px; height: 170px; left: 50%; top: 50%; transform: translate(-50%, -50%); z-index: 100; transition: left 0.8s ease-out, top 0.8s ease-out; }
        .mofu-body { width: 100%; height: 100%; background: #fff; border-radius: 50% 50% 45% 45%; border: 7px solid var(--sub); position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 15px 30px rgba(0,0,0,0.1); animation: float 4s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0) scale(1, 1); } 50% { transform: translateY(-15px) scale(1.02, 0.98); } }
        
        .face { font-size: 55px; transition: 0.2s; }
        .equip { position: absolute; font-size: 60px; pointer-events: none; z-index: 110; transition: 0.1s; }
        
        /* å¹ãå‡ºã— */
        #speech { position: absolute; top: -100px; background: white; border: 3px solid var(--main); padding: 10px 15px; border-radius: 20px; font-weight: 900; opacity: 0; transition: 0.3s; white-space: nowrap; pointer-events: none; }
        #speech::after { content: ''; position: absolute; bottom: -13px; left: 50%; transform: translateX(-50%); border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 10px solid var(--main); }

        /* --- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»ã‚·ãƒ¼ãƒˆ --- */
        .menu-bar { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: center; gap: 8px; z-index: 2000; }
        .m-btn { padding: 12px 18px; border-radius: 20px; border: none; background: white; border-bottom: 5px solid #ddd; font-weight: 900; cursor: pointer; transition: 0.1s; font-size: 14px; }
        .m-btn:active { transform: translateY(4px); border-bottom-width: 0; }
        
        .sheet { position: fixed; bottom: -110%; left: 0; width: 100%; height: 85%; background: white; border-radius: 35px 35px 0 0; z-index: 3000; transition: 0.5s cubic-bezier(0.19, 1, 0.22, 1); padding: 30px; box-sizing: border-box; overflow-y: auto; box-shadow: 0 -10px 40px rgba(0,0,0,0.2); }
        .sheet.open { bottom: 0; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .item-card { background: #f9f9f9; padding: 15px; border-radius: 20px; text-align: center; border: 2px solid #eee; }

        /* --- ãƒã‚¤ãƒˆãƒŸãƒ‹ã‚²ãƒ¼ãƒ ç”»é¢ --- */
        #game-screen { position: fixed; inset: 0; background: #222; z-index: 4000; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; }
        #game-canvas { background: #333; border: 4px solid #555; border-radius: 20px; touch-action: none; }

        /* ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .fx-layer { position: fixed; inset: 0; pointer-events: none; z-index: 500; }
        .particle { position: absolute; animation: pUp 1s forwards; font-size: 30px; }
        @keyframes pUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px) scale(1.5); } }
    </style>
</head>
<body>

<div id="start-screen" style="position:fixed; inset:0; background:var(--orange); z-index:9000; display:none; flex-direction:column; align-items:center; justify-content:center; color:white;">
    <h1 style="font-size:40px; text-shadow: 0 4px #d84315;">ãƒ¢ãƒ•é€²åŒ–DX</h1>
    <p>ãã¿ã ã‘ã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚’è‚²ã¦ã‚ˆã†ï¼</p>
    <input id="un-in" placeholder="ãã¿ã®ãªã¾ãˆ" style="padding:15px; border-radius:15px; border:none; width:70%; margin:10px; font-size:18px; text-align:center;">
    <input id="pn-in" placeholder="ãƒ¢ãƒ•ã®ãªã¾ãˆ" style="padding:15px; border-radius:15px; border:none; width:70%; margin:10px; font-size:18px; text-align:center;">
    <button class="m-btn" style="width:70%; background:var(--main); color:white; border:none; font-size:20px;" onclick="init()">ã¼ã†ã‘ã‚“ã‚’ã¯ã˜ã‚ã‚‹ï¼</button>
</div>

<div class="ui-layer">
    <div class="status-canvas">
        <div class="bar-wrap"><div class="bar-info"><span>ğŸ’– ããšãª</span><span id="v-kizuna">50%</span></div><div class="bar-bg"><div id="b-kizuna" class="bar-fill" style="background:var(--pink);"></div></div></div>
        <div class="bar-wrap"><div class="bar-info"><span>ğŸ™ ãŠãªã‹</span><span id="v-food">50%</span></div><div class="bar-bg"><div id="b-food" class="bar-fill" style="background:var(--orange);"></div></div></div>
        <div class="bar-wrap"><div class="bar-info"><span>ğŸ› ãã‚Œã„</span><span id="v-clean">50%</span></div><div class="bar-bg"><div id="b-clean" class="bar-fill" style="background:var(--blue);"></div></div></div>
        <div class="bar-wrap"><div class="bar-info"><span>âš¡ ã’ã‚“ã</span><span id="v-hp">100%</span></div><div class="bar-bg"><div id="b-hp" class="bar-fill" style="background:var(--green);"></div></div></div>
        <div class="bar-wrap"><div class="bar-info"><span>ğŸ“ ã‘ã„ã‘ã‚“</span><span id="v-exp">0%</span></div><div class="bar-bg"><div id="b-exp" class="bar-fill" style="background:var(--purple);"></div></div></div>
    </div>
    <div class="coin-display">ğŸ’° <span id="coin-val">0</span></div>
    <div class="lv-badge"><span style="font-size:10px;">Lv</span><div id="lv-val" style="font-size:28px; font-weight:900;">1</div></div>
</div>

<div id="mofu-world">
    <div id="mofu-container">
        <div id="speech"></div>
        <div id="mofu-body" class="mofu-body">
            <div id="face" class="face">ãƒ»â©Šãƒ»</div>
            <div id="eq-head" class="equip"></div>
            <div id="eq-face" class="equip"></div>
            <div id="eq-handR" class="equip"></div>
            <div id="eq-handL" class="equip"></div>
        </div>
        <div id="mofu-name-label" style="text-align:center; margin-top:10px; background:white; padding:2px 10px; border-radius:10px; border:2px solid var(--sub); font-weight:900;"></div>
    </div>
</div>

<div class="menu-bar">
    <button class="m-btn" onclick="openS('care')">ğŸ– ãŠä¸–è©±</button>
    <button class="m-btn" onclick="openS('work')">âš’ï¸ ãƒã‚¤ãƒˆ</button>
    <button class="m-btn" onclick="openS('shop')">ğŸ›’ ã‚·ãƒ§ãƒƒãƒ—</button>
    <button class="m-btn" onclick="openS('equip')">ğŸ§¥ ãã†ã³</button>
    <button class="m-btn" onclick="reset()" style="background:#ffccbc;">ğŸ”„</button>
</div>

<div id="sheet-care" class="sheet"><h2>ğŸ— ãŠä¸–è©±ã‚’ã™ã‚‹</h2><hr><div id="list-care" class="grid"></div><button class="m-btn" style="width:100%; margin-top:20px;" onclick="closeS()">é–‰ã˜ã‚‹</button></div>
<div id="sheet-work" class="sheet"><h2>âš’ï¸ ãƒã‚¤ãƒˆã«æŒ‘æˆ¦</h2><p>ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢ã—ã¦çµ¦æ–™ã‚’ã‚‚ã‚‰ãŠã†ï¼</p><hr><div id="list-work" class="grid"></div><button class="m-btn" style="width:100%; margin-top:20px;" onclick="closeS()">é–‰ã˜ã‚‹</button></div>
<div id="sheet-shop" class="sheet"><h2>ğŸ›’ ãƒ¢ãƒ•ã‚·ãƒ§ãƒƒãƒ—</h2><hr><div id="list-shop" class="grid"></div><button class="m-btn" style="width:100%; margin-top:20px;" onclick="closeS()">é–‰ã˜ã‚‹</button></div>
<div id="sheet-equip" class="sheet"><h2>ğŸ§¥ ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ</h2><p>ã‚¢ã‚¤ãƒ†ãƒ ã‚’é¸ã‚“ã§ä½ç½®ã‚’èª¿æ•´ï¼</p><div id="pos-ctrl" style="display:none; text-align:center; background:#eee; padding:10px; border-radius:15px; margin-bottom:10px;">èª¿æ•´ä¸­: <span id="cur-slot"></span><br><button class="m-btn" onclick="moveEq(0,-5)">â¬†</button><br><button class="m-btn" onclick="moveEq(-5,0)">â¬…</button><button class="m-btn" onclick="moveEq(5,0)">â¡</button><br><button class="m-btn" onclick="moveEq(0,5)">â¬‡</button></div><hr><div id="list-equip" class="grid"></div><button class="m-btn" style="width:100%; margin-top:20px;" onclick="closeS()">é–‰ã˜ã‚‹</button></div>

<div id="game-screen">
    <h2 id="game-title">ãƒã‚¤ãƒˆä¸­ï¼</h2>
    <canvas id="game-canvas" width="300" height="400"></canvas>
    <p id="game-info">ã‚¿ãƒƒãƒ—ã§ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¦éšœå®³ç‰©ã‚’é¿ã‘ã‚ï¼</p>
    <button class="m-btn" onclick="quitGame()">ã‚„ã‚ã‚‹</button>
</div>

<div id="fx-layer" class="fx-layer"></div>

<script>
    let d = JSON.parse(localStorage.getItem('mofu_dx_real')) || {
        un:"", pn:"", cn:100, lvl:1, exp:0,
        kizuna:50, food:50, clean:50, hp:100,
        items:[], eq:{head:"", face:"", handR:"", handL:""},
        pos:{head:{x:0,y:-55}, face:{x:0,y:10}, handR:{x:60,y:60}, handL:{x:-60,y:60}}
    };

    let isGame = false, editingSlot = "";

    window.onload = () => {
        if(d.un) start();
        else document.getElementById('start-screen').style.display = 'flex';
    };

    function init() {
        const u = document.getElementById('un-in').value;
        const p = document.getElementById('pn-in').value;
        if(!u || !p) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦ã­ï¼");
        d.un = u; d.pn = p;
        document.getElementById('start-screen').style.display = 'none';
        start();
    }

    function start() {
        document.getElementById('mofu-name-label').innerText = d.pn;
        update();
        setInterval(autoLogic, 5000);
        initPetting();
    }

    function update() {
        const setB = (id, val) => {
            document.getElementById('b-'+id).style.width = val + '%';
            document.getElementById('v-'+id).innerText = Math.floor(val) + '%';
        };
        setB('kizuna', d.kizuna); setB('food', d.food); setB('clean', d.clean); setB('hp', d.hp);
        setB('exp', (d.exp/(d.lvl*100))*100);
        
        document.getElementById('coin-val').innerText = d.cn;
        document.getElementById('lv-val').innerText = d.lvl;
        
        for(let s in d.eq) {
            const e = document.getElementById('eq-'+s);
            e.innerText = d.eq[s];
            e.style.transform = `translate(calc(-50% + ${d.pos[s].x}px), calc(-50% + ${d.pos[s].y}px))`;
            e.style.left = "50%"; e.style.top = "50%";
        }
        
        const face = document.getElementById('face');
        if(d.hp < 20) face.innerText = "ï¼â©Šï¼";
        else if(d.food < 20) face.innerText = "ğŸ˜µ";
        else if(d.kizuna > 80) face.innerText = "ï¼¾â©Šï¼¾";
        else face.innerText = "ãƒ»â©Šãƒ»";

        localStorage.setItem('mofu_dx_real', JSON.stringify(d));
    }

    // --- ã—ã‚ƒã¹ã‚‹ï¼†ãªã§ã‚‹ ---
    function say(txt) {
        const s = document.getElementById('speech');
        s.innerText = txt.replace("{un}", d.un);
        s.style.opacity = 1;
        setTimeout(() => s.style.opacity = 0, 3000);
    }

    function initPetting() {
        const m = document.getElementById('mofu-body');
        let isDown = false;
        const pet = (e) => {
            if(!isDown) return;
            d.kizuna = Math.min(100, d.kizuna + 0.2);
            if(Math.random() > 0.95) {
                spawnFX("â¤ï¸", e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY);
                say(Math.random() > 0.5 ? "{un}ã€ã‚‚ã£ã¨ï½ï¼" : "ãˆã¸ã¸ã€ãã‚‚ã¡ã„ã„ï¼");
            }
            update();
        };
        m.onmousedown = () => { isDown = true; m.style.transform = "scale(0.9)"; };
        window.onmouseup = () => { isDown = false; m.style.transform = ""; };
        m.ontouchstart = () => { isDown = true; m.style.transform = "scale(0.9)"; };
        window.ontouchend = () => { isDown = false; m.style.transform = ""; };
        m.onmousemove = pet; m.ontouchmove = pet;
    }

    function spawnFX(emoji, x, y) {
        const f = document.createElement('div');
        f.className = 'particle'; f.innerText = emoji;
        f.style.left = x + 'px'; f.style.top = y + 'px';
        document.getElementById('fx-layer').appendChild(f);
        setTimeout(() => f.remove(), 1000);
    }

    // --- è‡ªå‹•ãƒ­ã‚¸ãƒƒã‚¯ ---
    function autoLogic() {
        if(isGame) return;
        d.food = Math.max(0, d.food - 0.5);
        d.clean = Math.max(0, d.clean - 0.3);
        if(d.food < 10) say("{un}ã€ãŠãªã‹ã™ã„ãŸã‚ˆã‰...");
        
        // æ­©ã
        const c = document.getElementById('mofu-container');
        c.style.left = (20 + Math.random() * 60) + "%";
        c.style.top = (30 + Math.random() * 40) + "%";
        update();
    }

    // --- ãƒã‚¤ãƒˆãƒŸãƒ‹ã‚²ãƒ¼ãƒ  (æœ¬æ°—) ---
    function startWork(type) {
        closeS();
        document.getElementById('game-screen').style.display = 'flex';
        isGame = true;
        
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        let playerY = 350, velocity = 0, score = 0, frames = 0, obstacles = [];
        
        const loop = () => {
            if(!isGame) return;
            ctx.clearRect(0,0,300,400);
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼(ãƒ¢ãƒ•)
            velocity += 0.8; playerY += velocity;
            if(playerY > 350) { playerY = 350; velocity = 0; }
            ctx.font = "40px Arial"; ctx.fillText("â˜ï¸", 50, playerY);
            
            // éšœå®³ç‰©
            if(frames % 60 === 0) obstacles.push({x:300, y:350});
            obstacles.forEach((o, i) => {
                o.x -= 5;
                ctx.fillText("ğŸŒµ", o.x, o.y);
                if(o.x < 80 && o.x > 20 && playerY > 310) { // è¡çª
                    endGame(score);
                }
                if(o.x < -50) { obstacles.splice(i, 1); score++; }
            });
            
            ctx.fillStyle = "white"; ctx.font = "20px Arial"; ctx.fillText("çµ¦æ–™: " + score*10 + "G", 10, 30);
            frames++;
            requestAnimationFrame(loop);
        };
        
        canvas.onclick = () => { if(playerY > 300) velocity = -12; };
        loop();
    }

    function endGame(score) {
        isGame = false;
        const pay = score * 10;
        d.cn += pay; d.exp += score * 5; d.hp = Math.max(0, d.hp - 20);
        document.getElementById('game-screen').style.display = 'none';
        alert(`ãƒã‚¤ãƒˆçµ‚äº†ï¼\nç¨¼ã„ã ãŠé‡‘: ${pay}G\nçµŒé¨“å€¤ã‚¢ãƒƒãƒ—ï¼`);
        checkLv(); update();
    }

    function quitGame() { isGame = false; document.getElementById('game-screen').style.display = 'none'; }

    // --- ãã®ä»–æ©Ÿèƒ½ ---
    function openS(id) { 
        document.getElementById('sheet-'+id).classList.add('open'); 
        const list = document.getElementById('list-'+id); list.innerHTML = "";
        
        if(id === 'care') {
            [{n:"ğŸ™ ãŠã«ãã‚Š",c:0,f:20,s:"ã‚‚ãã‚‚ãï¼"},{n:"ğŸ– ãŠè‚‰",c:50,f:50,s:"ã†ã¾ã™ãã‚‹ï¼"},{n:"ğŸ›€ ãŠé¢¨å‘‚",c:0,cl:100,s:"ãƒ”ã‚«ãƒ”ã‚«ã ã‚ˆï¼"},{n:"ğŸ’¤ ãŠæ˜¼å¯",c:0,h:100,s:"ãŠã‚„ã™ã¿..."}].forEach(i => {
                const b = document.createElement('div'); b.className="item-card";
                b.innerHTML = `${i.n}<br>ğŸ’°${i.c}G<br><button class="m-btn" onclick="doCare(${i.c},${i.f||0},${i.cl||0},${i.h||0},'${i.s}')">ä½¿ã†</button>`;
                list.appendChild(b);
            });
        }
        if(id === 'work') {
            [{n:"ğŸ§¹ æƒé™¤(ç°¡å˜)",t:"tap"},{n:"é…é”(æ¿€ãƒ ã‚º)",t:"game"}].forEach(w => {
                const b = document.createElement('div'); b.className="item-card";
                b.innerHTML = `${w.n}<br><button class="m-btn" onclick="startWork()">é–‹å§‹</button>`;
                list.appendChild(b);
            });
        }
        if(id === 'shop') {
            [{n:"ğŸ‘‘ ç‹å† ",p:500,s:"head",v:"ğŸ‘‘"},{n:"ğŸ‘“ çœ¼é¡",p:200,s:"face",v:"ğŸ‘“"},{n:"ğŸ—¡ ä¼èª¬ã®å‰£",p:2000,s:"handR",v:"ğŸ—¡"}].forEach(i => {
                const b = document.createElement('div'); b.className="item-card";
                b.innerHTML = `${i.v} ${i.n}<br>ğŸ’°${i.p}G<br><button class="m-btn" onclick="buy('${i.n}',${i.p},'${i.s}','${i.v}')">è³¼å…¥</button>`;
                list.appendChild(b);
            });
        }
        if(id === 'equip') {
            if(d.items.length === 0) list.innerHTML = "æŒã¡ç‰©ãŒãªã„ã‚ˆ";
            d.items.forEach(i => {
                const b = document.createElement('button'); b.className="m-btn"; b.innerText = i.n;
                b.onclick = () => { d.eq[i.s] = i.v; editingSlot = i.s; document.getElementById('pos-ctrl').style.display='block'; document.getElementById('cur-slot').innerText=i.n; update(); };
                list.appendChild(b);
            });
        }
    }
    
    function closeS() { document.querySelectorAll('.sheet').forEach(s => s.classList.remove('open')); }
    
    function doCare(c, f, cl, h, s) {
        if(d.cn < c) return alert("ãŠé‡‘ãŒè¶³ã‚Šãªã„ã‚ˆï¼");
        d.cn -= c; d.food = Math.min(100, d.food + f); d.clean = Math.min(100, d.clean + cl); d.hp = Math.min(100, d.hp + h);
        say(s); update();
    }
    
    function buy(n, p, s, v) {
        if(d.cn < p) return alert("ãŠé‡‘ãŒè¶³ã‚Šãªã„ã‚ˆï¼");
        d.cn -= p; d.items.push({n, s, v}); alert(n + "ã‚’è²·ã£ãŸã‚ˆï¼"); update();
    }

    function moveEq(x, y) { if(editingSlot) { d.pos[editingSlot].x += x; d.pos[editingSlot].y += y; update(); } }
    function checkLv() { if(d.exp >= d.lvl*100) { d.lvl++; d.exp = 0; say("ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼å¤©æ‰ã‹ã‚‚ï¼"); update(); } }
    function reset() { if(confirm("ãƒªã‚»ãƒƒãƒˆã™ã‚‹ï¼Ÿ")) { localStorage.clear(); location.reload(); } }
</script>
</body>
</html>
