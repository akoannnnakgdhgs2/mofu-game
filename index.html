<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ¢ãƒ•é€²åŒ–DX -Premium-</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@900&display=swap');
        :root { --main: #6d4c41; --sub: #d7ccc8; --pink: #ff8a80; --orange: #ffb74d; --blue: #81d4fa; --purple: #b39ddb; --gold: #ffd700; --heart: #f44336; }
        body { margin: 0; height: 100vh; overflow: hidden; background: #fffcf5; font-family: 'Zen Maru Gothic', sans-serif; touch-action: none; }
        .ui-header { position: fixed; top: 10px; left: 10px; z-index: 100; pointer-events: none; }
        .status-box { background: rgba(255,255,255,0.95); padding: 10px; border-radius: 20px; border: 3px solid var(--sub); pointer-events: auto; width: 155px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .status-row { display: flex; align-items: center; gap: 5px; margin-bottom: 4px; font-size: 11px; }
        .bar-bg { flex-grow: 1; height: 10px; background: #eee; border-radius: 5px; overflow: hidden; }
        .bar-fill { height: 100%; transition: 0.5s; }
        .lv-area { position: fixed; top: 15px; right: 15px; z-index: 100; }
        .lv-circle-box { width: 85px; height: 85px; position: relative; background: white; border-radius: 50%; border: 5px solid var(--gold); display: flex; align-items: center; justify-content: center; flex-direction: column; }
        #mofu-container { position: absolute; transition: left 2.5s ease-in-out, top 2.5s ease-in-out; display: flex; flex-direction: column; align-items: center; z-index: 50; }
        .mofu-body { width: 140px; height: 130px; background: #fff; border-radius: 50% 50% 48% 48%; border: 6px solid var(--sub); display: flex; justify-content: center; align-items: center; position: relative; cursor: pointer; }
        .face { font-size: 40px; user-select: none; }
        #speech { position: absolute; top: -95px; background: white; border: 3px solid var(--main); border-radius: 20px; padding: 10px; opacity: 0; transition: 0.3s; font-weight: 900; z-index: 200; white-space: nowrap; }
        .menu { position: fixed; bottom: 15px; width: 100%; display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; z-index: 110; }
        .btn { padding: 12px 16px; border-radius: 20px; border: none; background: white; font-weight: 900; border-bottom: 5px solid var(--sub); cursor: pointer; font-family: inherit; }
        .btn-orange { background: var(--orange); color: white; border-bottom-color: #e6a742; }
        .sheet { position: fixed; bottom: -100%; left: 0; width: 100%; height: 85%; background: white; border-radius: 40px 40px 0 0; border-top: 8px solid var(--sub); z-index: 400; transition: 0.4s; padding: 25px; box-sizing: border-box; overflow-y: auto; }
        .sheet.open { bottom: 0; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .fade { position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; z-index:350; }
        .id-card { background: #333; color: #00ffcc; padding: 10px; border-radius: 10px; font-family: monospace; text-align: center; margin: 10px 0; }
    </style>
</head>
<body>

<div id="start-screen" style="position:fixed; inset:0; background:white; z-index:3000; display:flex; flex-direction:column; align-items:center; justify-content:center;">
    <h2 style="color:var(--orange);">ãƒ¢ãƒ•é€²åŒ–DX</h2>
    <input type="text" id="un-in" style="padding:15px; margin:5px; border-radius:15px; border:3px solid var(--sub); width:70%;" placeholder="ãã¿ã®ãªã¾ãˆ">
    <input type="text" id="pn-in" style="padding:15px; margin:5px; border-radius:15px; border:3px solid var(--sub); width:70%;" placeholder="ãƒ¢ãƒ•ã®ãªã¾ãˆ">
    <button class="btn btn-orange" style="margin-top:15px; width:70%;" onclick="startGame()">å†’é™ºã‚’ã¯ã˜ã‚ã‚‹ï¼</button>
</div>

<div class="ui-header">
    <div class="status-box">
        <div class="status-row">ğŸ’–<div class="bar-bg"><div id="b-kizuna" class="bar-fill" style="background:var(--heart);"></div></div></div>
        <div class="status-row">âš¡<div class="bar-bg"><div id="b-hp" class="bar-fill" style="background:var(--blue);"></div></div></div>
        <div style="font-weight:900; color:var(--main); margin-top:5px;">ğŸ’° <span id="coin">100</span></div>
    </div>
</div>

<div class="lv-area"><div class="lv-circle-box"><div style="font-size:10px;">Lv</div><div id="v-lvl" style="font-size:24px; font-weight:900;">1</div></div></div>

<div id="mofu-container">
    <div id="speech"></div>
    <div id="my-costume" style="position:absolute; top:-50px; font-size:60px;"></div>
    <div id="my-mofu" class="mofu-body" onclick="petMofu()">
        <div id="my-face" class="face">ãƒ»â©Šãƒ»</div>
    </div>
    <h3 id="mofu-name-display" style="background:white; padding:2px 10px; border-radius:10px; border:2px solid var(--sub); margin-top:10px;"></h3>
</div>

<div class="menu">
    <button class="btn btn-orange" onclick="openSheet('comm-sheet')">ğŸ“¶ é€šä¿¡</button>
    <button class="btn" onclick="openSheet('care-sheet')">âœ¨ ãŠä¸–è©±</button>
    <button class="btn" onclick="openSheet('work-sheet')">âš’ï¸ ãƒã‚¤ãƒˆ</button>
    <button class="btn" onclick="openSheet('shop-sheet')">ğŸ›’ ã‚·ãƒ§ãƒƒãƒ—</button>
    <button class="btn" onclick="resetGame()" style="background:#ff8a80; color:white;">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<div id="comm-sheet" class="sheet">
    <h3>ğŸ“¶ é€šä¿¡ãƒãƒ¼ã‚¿ãƒ«</h3><hr>
    <p>ãã¿ã®ãƒã‚¤ID:</p><div class="id-card" id="my-id">ç™ºè¡Œä¸­...</div>
    <button class="btn" style="width:100%" onclick="copyId()">IDã‚’ã‚³ãƒ”ãƒ¼</button>
    <button class="btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">æˆ»ã‚‹</button>
</div>

<div id="care-sheet" class="sheet"><h3>âœ¨ ãŠä¸–è©±ã‚’ã™ã‚‹</h3><hr><div class="grid" id="care-list"></div><button class="btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">æˆ»ã‚‹</button></div>
<div id="work-sheet" class="sheet"><h3>âš’ï¸ ãƒã‚¤ãƒˆ</h3><hr><div class="grid" id="work-list"></div><button class="btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">æˆ»ã‚‹</button></div>
<div id="shop-sheet" class="sheet"><h3>ğŸ›’ ã‚·ãƒ§ãƒƒãƒ—</h3><hr><div class="grid" id="shop-list"></div><button class="btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">æˆ»ã‚‹</button></div>
<div id="dark-fade" class="fade" onclick="closeSheet()"></div>

<script>
    let d = JSON.parse(localStorage.getItem('mofu_data_v2')) || { un:"", pn:"", cn:100, lvl:1, exp:0, hp:100, items:[], eq:"", kizuna:0 };
    let peer = null;

    function saveData() { localStorage.setItem('mofu_data_v2', JSON.stringify(d)); }

    function getPhrases() {
        return {
            idle: [d.un + "ã€ãªã«ã—ã¦ã‚‹ã®ï¼Ÿ", "å†’é™ºã«ã„ããŸã„ãªï¼", "ãªã§ãªã§ã—ã¦ã€œ", d.un + "ã ã„ã™ãï¼"],
            pet: ["ã‚€ãã‚…ã€œï¼ğŸ’–", d.un + "ã®æ‰‹ã€ã‚ã£ãŸã‹ã„ï¼", "ãˆã¸ã¸ã€ã†ã‚Œã—ã„ï¼"],
            work: ["ãƒã‚¤ãƒˆãŒã‚“ã°ã‚‹ãï¼", "ãŠé‡‘ã‚’ãŸã‚ã¦è²·ã„ç‰©ã—ã‚ˆã†ï¼"]
        };
    }

    function startGame() {
        if(!d.un) {
            d.un = document.getElementById('un-in').value || "ãƒã‚¹ã‚¿ãƒ¼";
            d.pn = document.getElementById('pn-in').value || "ãƒ¢ãƒ•";
        }
        document.getElementById('start-screen').style.display='none';
        document.getElementById('mofu-name-display').innerText = d.pn;
        updateUI(); startWalking();
        initPeer();
        setInterval(() => { if(Math.random()<0.1) { const ph = getPhrases(); say(ph.idle[Math.floor(Math.random()*ph.idle.length)]); } }, 10000);
    }

    if(d.un) startGame();

    function initPeer() {
        peer = new Peer();
        peer.on('open', id => document.getElementById('my-id').innerText = id);
    }

    function updateUI() {
        document.getElementById('coin').innerText = d.cn;
        document.getElementById('v-lvl').innerText = d.lvl;
        document.getElementById('b-kizuna').style.width = d.kizuna + "%";
        document.getElementById('b-hp').style.width = d.hp + "%";
        document.getElementById('my-costume').innerText = d.eq;
        saveData(); updateLists();
    }

    function petMofu() {
        const ph = getPhrases(); say(ph.pet[Math.floor(Math.random()*ph.pet.length)]);
        d.kizuna = Math.min(100, d.kizuna + 1); d.exp += 2;
        document.getElementById('my-face').innerText = "ï¼â©Šï¼œ";
        setTimeout(() => document.getElementById('my-face').innerText = "ãƒ»â©Šãƒ»", 1000);
        checkLv(); updateUI();
    }

    function checkLv() { if(d.exp >= 50 + (d.lvl * 20)) { d.lvl++; d.exp = 0; alert("ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼"); updateUI(); } }

    function startWalking() {
        setInterval(() => {
            const c = document.getElementById('mofu-container');
            const x = Math.random() * (window.innerWidth - 150);
            const y = Math.random() * (window.innerHeight - 300) + 100;
            c.style.left = x + 'px'; c.style.top = y + 'px';
        }, 5000);
    }

    function say(t) { const s=document.getElementById('speech'); s.innerText=t; s.style.opacity=1; setTimeout(()=>s.style.opacity=0, 2500); }
    function openSheet(id) { document.getElementById(id).classList.add('open'); document.getElementById('dark-fade').style.display='block'; }
    function closeSheet() { document.querySelectorAll('.sheet').forEach(s=>s.classList.remove('open')); document.getElementById('dark-fade').style.display='none'; }
    function copyId() { navigator.clipboard.writeText(document.getElementById('my-id').innerText); alert("IDã‚’ã‚³ãƒ”ãƒ¼ã—ãŸã‚ˆï¼"); }
    function resetGame() { if(confirm("æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™ï¼Ÿ")) { localStorage.removeItem('mofu_data_v2'); location.reload(); } }

    function updateLists() {
        // ãŠä¸–è©±ãƒªã‚¹ãƒˆ
        const cl = document.getElementById('care-list'); cl.innerHTML = "";
        ["ğŸ¾ãƒœãƒ¼ãƒ«", "ğŸ›€ãŠé¢¨å‘‚", "ğŸ›ŒãŠæ˜¼å¯", "ğŸƒèµ°ã‚‹", "ğŸ–Œï¸ãƒ–ãƒ©ã‚·"].forEach(n => {
            const b = document.createElement('button'); b.className='btn'; b.innerText=n;
            b.onclick = () => { d.kizuna = Math.min(100, d.kizuna+5); d.hp = Math.max(0, d.hp-10); say(n + "ã—ã¦æ¥½ã—ã‹ã£ãŸï¼"); closeSheet(); updateUI(); };
            cl.appendChild(b);
        });

        // ãƒã‚¤ãƒˆãƒªã‚¹ãƒˆï¼ˆæ‰‹å‹•ï¼‰
        const wl = document.getElementById('work-list'); wl.innerHTML = "";
        [{n:"ğŸ§¹æƒé™¤", m:30, h:20}, {n:"ğŸ“¦é‹ã³", m:80, h:40}, {n:"ğŸššé…é”", m:200, h:60}].forEach(w => {
            const b = document.createElement('button'); b.className='btn'; b.innerText=`${w.n}(+ğŸ’°${w.m})`;
            b.onclick = () => {
                if(d.hp < w.h) { alert("ä½“åŠ›ãŒè¶³ã‚Šãªã„ã‚ˆï¼ãŠæ˜¼å¯ã•ã›ã¦ã‚ã’ã¦ã€‚"); return; }
                d.cn += w.m; d.hp -= w.h; say(w.n + "ãŒã‚“ã°ã£ãŸã‚ˆï¼ğŸ’°"); closeSheet(); updateUI();
            };
            wl.appendChild(b);
        });

        // ã‚·ãƒ§ãƒƒãƒ—
        const sl = document.getElementById('shop-list'); sl.innerHTML = "";
        [{n:"ğŸ€ãƒªãƒœãƒ³", p:50, e:"ğŸ€"}, {n:"ğŸ‘‘ç‹å† ", p:500, e:"ğŸ‘‘"}, {n:"ğŸ­ã‚¢ãƒ¡", p:20, e:"ğŸ­"}].forEach(i => {
            const b = document.createElement('button'); b.className='btn'; b.innerText=`${i.n}(ğŸ’°${i.p})`;
            b.onclick = () => { if(d.cn>=i.p){ d.cn-=i.p; d.items.push(i.e); updateUI(); } else { alert("ãŠé‡‘ãŒè¶³ã‚Šãªã„ã‚ˆï¼"); } };
            sl.appendChild(b);
        });
    }
</script>
</body>
</html>
