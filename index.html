<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ¢ãƒ•é€²åŒ–DX -Final-</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@900&display=swap');
        :root { --main: #5d4037; --sub: #efebe9; --pink: #ff80ab; --orange: #ffb74d; --blue: #4fc3f7; --green: #81c784; --purple: #b39ddb; }
        body { margin: 0; height: 100vh; overflow: hidden; background: #fffdf0; font-family: 'Zen Maru Gothic', sans-serif; touch-action: none; user-select: none; }

        /* UI */
        .status-canvas { position: fixed; top: 10px; left: 10px; z-index: 1000; width: 180px; background: rgba(255,255,255,0.9); padding: 10px; border-radius: 20px; border: 3px solid var(--sub); }
        .bar-bg { width: 100%; height: 8px; background: #eee; border-radius: 4px; overflow: hidden; margin-bottom: 5px; }
        .bar-fill { height: 100%; width: 50%; transition: 0.3s; }
        .coin-display { position: fixed; top: 15px; right: 90px; background: white; padding: 5px 15px; border-radius: 20px; border: 3px solid gold; font-weight: 900; z-index: 1000; }
        .lv-badge { position: fixed; top: 10px; right: 10px; width: 60px; height: 60px; background: white; border: 4px solid #ff5252; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 900; z-index: 1000; }

        /* ãƒ¢ãƒ•ã¨é¢¨ */
        #mofu-container { position: absolute; width: 180px; height: 180px; left: 50%; top: 50%; transform: translate(-50%, -50%); transition: 2s ease-in-out; z-index: 100; }
        .mofu-body { width: 100%; height: 100%; background: #fff; border-radius: 50% 50% 45% 45%; border: 7px solid var(--sub); display: flex; justify-content: center; align-items: center; position: relative; animation: float 4s infinite ease-in-out; }
        @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        
        .face { font-size: 50px; }
        .equip { position: absolute; font-size: 55px; pointer-events: none; left: 50%; top: 50%; transform: translate(-50%, -50%); }
        #speech { position: absolute; top: -80px; background: white; border: 3px solid var(--main); padding: 8px 12px; border-radius: 15px; opacity: 0; transition: 0.3s; font-weight: 900; white-space: nowrap; }

        /* ãƒœã‚¿ãƒ³ã¨ã‚·ãƒ¼ãƒˆ */
        .menu-bar { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: center; gap: 8px; z-index: 2000; }
        .m-btn { padding: 12px 15px; border-radius: 18px; border: none; background: white; border-bottom: 4px solid #ddd; font-weight: 900; cursor: pointer; }
        .m-btn:active { transform: translateY(2px); border-bottom-width: 2px; }
        .locked { background: #eee !important; color: #aaa !important; }

        .sheet { position: fixed; bottom: -110%; left: 0; width: 100%; height: 80%; background: white; border-radius: 30px 30px 0 0; z-index: 3000; transition: 0.4s ease; padding: 25px; box-sizing: border-box; overflow-y: auto; }
        .sheet.open { bottom: 0; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .card { background: #f8f8f8; padding: 10px; border-radius: 15px; text-align: center; }

        #game-screen { position: fixed; inset: 0; background: #222; z-index: 4000; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .wind { position: fixed; height: 2px; background: rgba(255,255,255,0.5); pointer-events: none; animation: windMove 2s linear forwards; }
        @keyframes windMove { from { left: -100px; } to { left: 100vw; } }
    </style>
</head>
<body>

<div id="start-screen" style="position:fixed; inset:0; background:var(--orange); z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white;">
    <h1>ãƒ¢ãƒ•é€²åŒ–DX</h1>
    <input id="u-in" placeholder="ãã¿ã®åå‰" style="padding:15px; margin:5px; border-radius:10px; border:none; text-align:center;">
    <input id="p-in" placeholder="ãƒ¢ãƒ•ã®åå‰" style="padding:15px; margin:5px; border-radius:10px; border:none; text-align:center;">
    <button class="m-btn" onclick="initGame()">ã¯ã˜ã‚ã‚‹</button>
</div>

<div class="ui-layer">
    <div class="status-canvas">
        <div class="bar-bg"><div id="b-kizuna" class="bar-fill" style="background:var(--pink);"></div></div>
        <div class="bar-bg"><div id="b-food" class="bar-fill" style="background:var(--orange);"></div></div>
        <div class="bar-bg"><div id="b-clean" class="bar-fill" style="background:var(--blue);"></div></div>
        <div class="bar-bg"><div id="b-hp" class="bar-fill" style="background:var(--green);"></div></div>
        <div class="bar-bg"><div id="b-exp" class="bar-fill" style="background:var(--purple);"></div></div>
    </div>
    <div class="coin-display">ğŸ’° <span id="coin-val">0</span></div>
    <div id="lv-val" class="lv-badge">1</div>
</div>

<div id="mofu-container">
    <div id="speech"></div>
    <div id="mofu-body" class="mofu-body" onclick="petMofu()">
        <div id="face" class="face">ãƒ»â©Šãƒ»</div>
        <div id="eq-head" class="equip"></div><div id="eq-face" class="equip"></div>
        <div id="eq-handR" class="equip"></div><div id="eq-handL" class="equip"></div>
    </div>
    <div id="name-tag" style="text-align:center; margin-top:10px; font-weight:900;"></div>
</div>

<div class="menu-bar">
    <button class="m-btn" onclick="showSheet('care')">ğŸ–ãŠä¸–è©±</button>
    <button class="m-btn" onclick="showSheet('work')">âš’ï¸ãƒã‚¤ãƒˆ</button>
    <button class="m-btn" onclick="showSheet('shop')">ğŸ›’ã‚·ãƒ§ãƒƒãƒ—</button>
    <button class="m-btn" onclick="showSheet('equip')">ğŸ§¥ãã†ã³</button>
    <button class="m-btn" onclick="resetAll()" style="background:#ffccbc;">ğŸ”„</button>
</div>

<div id="s-care" class="sheet"><h2>ãŠä¸–è©±</h2><div id="l-care" class="grid"></div><button class="m-btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">é–‰ã˜ã‚‹</button></div>
<div id="s-work" class="sheet"><h2>ãƒã‚¤ãƒˆ</h2><div id="l-work" class="grid"></div><button class="m-btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">é–‰ã˜ã‚‹</button></div>
<div id="s-shop" class="sheet"><h2>ã‚·ãƒ§ãƒƒãƒ—</h2><div id="l-shop" class="grid"></div><button class="m-btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">é–‰ã˜ã‚‹</button></div>
<div id="s-equip" class="sheet"><h2>ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ</h2><div id="pos-ui" style="display:none; text-align:center; padding:10px; background:#eee; border-radius:10px;">ä½ç½®èª¿æ•´: <button onclick="move(-5,0)">â¬…</button><button onclick="move(5,0)">â¡</button><button onclick="move(0,-5)">â¬†</button><button onclick="move(0,5)">â¬‡</button></div><div id="l-equip" class="grid"></div><button class="m-btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">é–‰ã˜ã‚‹</button></div>

<div id="game-screen">
    <h2 id="g-score">çµ¦æ–™: 0G</h2>
    <canvas id="canvas" width="300" height="400" style="background:#333; border-radius:20px;"></canvas>
    <p>ã‚¿ãƒƒãƒ—ã§ã‚¸ãƒ£ãƒ³ãƒ—ï¼</p>
    <button class="m-btn" onclick="isG=false; document.getElementById('game-screen').style.display='none'">é€ƒã’ã‚‹</button>
</div>

<script>
    let d = JSON.parse(localStorage.getItem('mofu_final')) || {
        un:"", pn:"", cn:100, lvl:1, exp:0, kz:50, fd:50, cl:50, hp:100, items:[],
        eq:{head:"",face:"",handR:"",handL:""},
        pos:{head:{x:0,y:-55},face:{x:0,y:10},handR:{x:60,y:60},handL:{x:-60,y:60}}
    };
    let isG = false, curS = "";

    function initGame() {
        d.un = document.getElementById('u-in').value || "ã„ã£ãã‚“";
        d.pn = document.getElementById('p-in').value || "ãƒ¢ãƒ•";
        document.getElementById('start-screen').style.display = 'none';
        save(); updateUI(); setInterval(loop, 3000);
    }

    if(d.un) initGame();

    function save() { localStorage.setItem('mofu_final', JSON.stringify(d)); }

    function updateUI() {
        document.getElementById('b-kizuna').style.width = d.kz+'%';
        document.getElementById('b-food').style.width = d.fd+'%';
        document.getElementById('b-clean').style.width = d.cl+'%';
        document.getElementById('b-hp').style.width = d.hp+'%';
        document.getElementById('b-exp').style.width = (d.exp/(d.lvl*100))*100+'%';
        document.getElementById('coin-val').innerText = d.cn;
        document.getElementById('lv-val').innerText = d.lvl;
        document.getElementById('name-tag').innerText = d.pn;
        for(let key in d.eq) {
            let el = document.getElementById('eq-'+key);
            el.innerText = d.eq[key];
            el.style.marginLeft = d.pos[key].x + 'px';
            el.style.marginTop = d.pos[key].y + 'px';
        }
        save();
    }

    function say(t) {
        let s = document.getElementById('speech');
        s.innerText = t.replace("{un}", d.un); s.style.opacity = 1;
        setTimeout(() => s.style.opacity = 0, 2000);
    }

    function petMofu() {
        d.kz = Math.min(100, d.kz + 2);
        say("{un}ã€ãªã§ãªã§ã ã„ã™ãï¼");
        updateUI();
    }

    function loop() {
        if(isG) return;
        d.fd = Math.max(0, d.fd - 1);
        let c = document.getElementById('mofu-container');
        c.style.left = (20 + Math.random()*60) + "%";
        c.style.top = (30 + Math.random()*40) + "%";
        if(Math.random() > 0.7) {
            let w = document.createElement('div'); w.className = 'wind';
            w.style.top = Math.random()*100+'vh'; w.style.width = (50+Math.random()*100)+'px';
            document.body.appendChild(w); setTimeout(() => w.remove(), 2000);
        }
        updateUI();
    }

    function showSheet(id) {
        document.querySelectorAll('.sheet').forEach(s => s.classList.remove('open'));
        document.getElementById('s-'+id).classList.add('open');
        let l = document.getElementById('l-'+id); l.innerHTML = "";

        if(id === 'care') {
            const opts = [{n:"ğŸ™ãŠã«ãã‚Š",l:1,f:20,e:10},{n:"ğŸ–ãŠè‚‰",l:3,f:50,e:30},{n:"ğŸ›€ãŠé¢¨å‘‚",l:1,cl:100,e:5}];
            opts.forEach(o => {
                let locked = d.lvl < o.l;
                l.innerHTML += `<div class="card">${o.n}${locked?'(Lv'+o.l+')':''}<br><button class="m-btn ${locked?'locked':''}" onclick="doCare(${o.f||0},${o.cl||0},${o.e},${o.l})">ä½¿ã†</button></div>`;
            });
        }
        if(id === 'work') {
            const works = [{n:"é…é”",l:1,s:5},{n:"å·¥äº‹",l:3,s:8}];
            works.forEach(w => {
                let locked = d.lvl < w.l;
                l.innerHTML += `<div class="card">${w.n}${locked?'(Lv'+w.l+')':''}<br><button class="m-btn ${locked?'locked':''}" onclick="startMini(${w.s},${w.l})">é–‹å§‹</button></div>`;
            });
        }
        if(id === 'shop') {
            const items = [{n:"ğŸ‘‘ç‹å† ",l:5,p:500,s:"head",v:"ğŸ‘‘"},{n:"ğŸ•¶çœ¼é¡",l:2,p:200,s:"face",v:"ğŸ•¶"}];
            items.forEach(i => {
                let locked = d.lvl < i.l;
                l.innerHTML += `<div class="card">${i.v}ğŸ’°${i.p}<br><button class="m-btn ${locked?'locked':''}" onclick="buyItem('${i.n}',${i.p},'${i.s}','${i.v}',${i.l})">è²·ã†</button></div>`;
            });
        }
        if(id === 'equip') {
            d.items.forEach((it,idx) => {
                l.innerHTML += `<button class="m-btn" onclick="setEq('${it.s}','${it.v}')">${it.n}</button>`;
            });
        }
    }

    function doCare(f,cl,e,l) {
        if(d.lvl < l) return;
        d.fd = Math.min(100, d.fd+f); d.cl = Math.min(100, d.cl+cl); d.exp += e;
        checkLv(); updateUI(); showSheet('care');
    }

    function buyItem(n,p,s,v,l) {
        if(d.lvl < l || d.cn < p) return alert("è²·ãˆãªã„ã‚ˆï¼");
        d.cn -= p; d.items.push({n,s,v}); updateUI(); showSheet('shop');
    }

    function setEq(s,v) { d.eq[s] = v; curS = s; document.getElementById('pos-ui').style.display='block'; updateUI(); }
    function move(x,y) { if(curS){ d.pos[curS].x+=x; d.pos[curS].y+=y; updateUI(); } }

    function startMini(speed, l) {
        if(d.lvl < l) return;
        closeSheet(); isG = true; document.getElementById('game-screen').style.display='flex';
        let canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
        let py = 350, v = 0, score = 0, obs = [];
        canvas.onclick = () => { if(py > 300) v = -12; };
        function gLoop() {
            if(!isG) return;
            ctx.clearRect(0,0,300,400); v += 0.8; py += v; if(py > 350){ py = 350; v = 0; }
            ctx.font = "40px Arial"; ctx.fillText("â˜ï¸", 50, py);
            if(Math.random() < 0.02) obs.push({x:300, y:350});
            obs.forEach((o,i) => {
                o.x -= speed; ctx.fillText("ğŸŒµ", o.x, o.y);
                if(o.x < 80 && o.x > 20 && py > 310) { isG = false; d.cn += score*10; d.exp += score*5; alert(score*10+"Gç²å¾—ï¼"); document.getElementById('game-screen').style.display='none'; checkLv(); updateUI(); }
                if(o.x < -50){ obs.splice(i,1); score++; document.getElementById('g-score').innerText = "çµ¦æ–™: "+(score*10)+"G"; }
            });
            requestAnimationFrame(gLoop);
        }
        gLoop();
    }

    function checkLv() { if(d.exp >= d.lvl*100){ d.exp=0; d.lvl++; say("ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼å¤©æ‰ï¼"); } }
    function closeSheet() { document.querySelectorAll('.sheet').forEach(s => s.classList.remove('open')); }
    function resetAll() { if(confirm("æ¶ˆã™ï¼Ÿ")){ localStorage.clear(); location.reload(); } }
</script>
</body>
</html>
