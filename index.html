<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ¢ãƒ•é€²åŒ–DX -Connect-</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@900&display=swap');
        :root { --main: #5d4037; --sub: #efebe9; --pink: #ff80ab; --orange: #ffb74d; --blue: #4fc3f7; --green: #81c784; --purple: #b39ddb; }
        body { margin: 0; height: 100vh; overflow: hidden; background: #fffdf0; font-family: 'Zen Maru Gothic', sans-serif; touch-action: none; user-select: none; }

        /* --- UIãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆç¶­æŒï¼‰ --- */
        .ui-top { position: fixed; top: 10px; left: 10px; z-index: 1000; width: 160px; pointer-events: none; }
        .bar-wrap { margin-bottom: 5px; background: rgba(255,255,255,0.8); border-radius: 10px; padding: 2px 5px; border: 2px solid var(--sub); }
        .bar-bg { width: 100%; height: 6px; background: #ddd; border-radius: 3px; overflow: hidden; }
        .bar-fill { height: 100%; width: 50%; transition: width 0.3s; }
        .coin-box { position: fixed; top: 15px; right: 80px; background: white; padding: 5px 12px; border-radius: 20px; border: 3px solid gold; font-weight: 900; z-index: 1000; }
        .lv-badge { position: fixed; top: 10px; right: 10px; width: 55px; height: 55px; background: #ff5252; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 900; z-index: 1000; }

        /* --- é€šä¿¡çŠ¶æ…‹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ --- */
        #network-status { position: fixed; top: 75px; right: 10px; font-size: 12px; background: rgba(0,0,0,0.5); color: white; padding: 2px 8px; border-radius: 10px; z-index: 1000; }

        /* --- ãƒ¢ãƒ•æœ¬ä½“ï¼ˆç¶­æŒï¼‰ --- */
        #mofu-area { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 50; transition: background 0.5s; }
        #mofu-container { width: 200px; height: 200px; position: relative; transition: 0.2s; cursor: pointer; }
        .mofu-body { width: 100%; height: 100%; background: #fff; border-radius: 50% 50% 45% 45%; border: 7px solid var(--sub); position: relative; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 20px rgba(0,0,0,0.1); animation: float 4s infinite ease-in-out; }
        @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        
        #fx-layer { position: fixed; inset: 0; pointer-events: none; z-index: 9999; }
        .heart { position: absolute; font-size: 30px; animation: heartUp 0.8s forwards; }
        @keyframes heartUp { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: translateY(-100px) scale(1.5); } }

        /* --- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ --- */
        .menu-bar { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: center; gap: 5px; z-index: 2000; }
        .m-btn { padding: 10px 12px; border-radius: 15px; border: none; background: white; border-bottom: 4px solid #ddd; font-weight: 900; cursor: pointer; font-size: 13px; }
        .m-btn:active { transform: translateY(2px); border-bottom-width: 0; }

        .sheet { position: fixed; bottom: -110%; left: 0; width: 100%; height: 80%; background: white; border-radius: 30px 30px 0 0; z-index: 3000; transition: 0.4s ease-out; padding: 25px; box-sizing: border-box; overflow-y: auto; }
        .sheet.open { bottom: 0; }
        
        /* è¨ªå•ä¸­ã‚¢ãƒ©ãƒ¼ãƒˆ */
        #visit-overlay { position: fixed; top: 0; width: 100%; background: var(--purple); color: white; text-align: center; padding: 5px; font-weight: 900; z-index: 5000; display: none; }
    </style>
</head>
<body>

<div id="visit-overlay">ğŸ  ç¾åœ¨ã€ãŠå‹é”ã®ã€Œ<span id="target-name">...</span>ã€ã®åºŠã«éŠã³ã«ãã¦ã„ã¾ã™ï¼</div>

<div id="start-screen" style="position:fixed; inset:0; background:var(--orange); z-index:10000; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white;">
    <h1>ãƒ¢ãƒ•é€²åŒ–DX</h1>
    <input id="u-in" placeholder="ãã¿ã®åå‰" style="padding:15px; border-radius:10px; width:70%; margin-bottom:10px;">
    <input id="p-in" placeholder="ãƒ¢ãƒ•ã®åå‰" style="padding:15px; border-radius:10px; width:70%; margin-bottom:20px;">
    <button class="m-btn" onclick="init()">ã¼ã†ã‘ã‚“é–‹å§‹ï¼</button>
</div>

<div id="fx-layer"></div>
<div id="network-status">My ID: <span id="my-id-display">---</span></div>

<div class="ui-top">
    <div class="bar-wrap">ğŸ’– ããšãª<div class="bar-bg"><div id="b-kz" class="bar-fill" style="background:var(--pink);"></div></div></div>
    <div class="bar-wrap">ğŸ™ ãŠãªã‹<div class="bar-bg"><div id="b-fd" class="bar-fill" style="background:var(--orange);"></div></div></div>
    <div class="bar-wrap">ğŸ“ çµŒé¨“<div class="bar-bg"><div id="b-ex" class="bar-fill" style="background:var(--purple);"></div></div></div>
</div>

<div class="coin-box">ğŸ’° <span id="coin-val">0</span></div>
<div id="lv-badge" class="lv-badge">1</div>

<div id="mofu-area">
    <div id="mofu-container">
        <div id="speech" style="position:absolute; top:-60px; background:white; border:3px solid var(--main); padding:8px 15px; border-radius:20px; font-weight:900; opacity:0; transition:0.3s; white-space:nowrap;"></div>
        <div id="mofu-body" class="mofu-body">
            <div id="face" style="font-size:60px;">ãƒ»â©Šãƒ»</div>
            <div id="eq-head" style="position:absolute; font-size:60px; top:50%; left:50%; transform:translate(-50%,-110%)"></div>
            <div id="eq-handR" style="position:absolute; font-size:60px; top:50%; left:50%; transform:translate(60%,0%)"></div>
        </div>
        <div id="mofu-name" style="text-align:center; margin-top:10px; font-weight:900; background:white; padding:2px 10px; border-radius:10px;"></div>
    </div>
</div>

<div class="menu-bar">
    <button class="m-btn" onclick="openS('care')">ğŸ– ãŠä¸–è©±</button>
    <button class="m-btn" onclick="openS('work')">âš’ï¸ ãƒã‚¤ãƒˆ</button>
    <button class="m-btn" onclick="openS('connect')" style="background:var(--purple); color:white;">ğŸŒ é€šä¿¡</button>
    <button class="m-btn" onclick="goHome()" id="home-btn" style="display:none; background:var(--green); color:white;">ğŸ  å¸°ã‚‹</button>
    <button class="m-btn" onclick="resetAll()">ğŸ”„</button>
</div>

<div id="s-connect" class="sheet">
    <h2>ğŸŒ é€šä¿¡ãŠã§ã‹ã‘</h2>
    <p>ãã¿ã®ID: <b id="my-id-show"></b></p>
    <hr>
    <p>å‹é”ã®IDã‚’å…¥åŠ›ã—ã¦éŠã³ã«è¡Œã“ã†ï¼</p>
    <input id="friend-id-in" placeholder="å‹é”ã®IDã‚’å…¥åŠ›" style="padding:15px; width:80%; border:2px solid var(--purple); border-radius:10px;">
    <button class="m-btn" onclick="visitFriend()" style="margin-top:10px; width:100%; background:var(--purple); color:white;">ãŠå‹é”ã®åºŠã¸GOï¼</button>
    <button class="m-btn" onclick="closeS()" style="width:100%; margin-top:10px;">é–‰ã˜ã‚‹</button>
</div>

<div id="s-care" class="sheet"><h2>ãŠä¸–è©±</h2><div id="l-care"></div><button class="m-btn" onclick="closeS()">é–‰ã˜ã‚‹</button></div>
<div id="s-work" class="sheet"><h2>ãƒã‚¤ãƒˆ</h2><div id="l-work"></div><button class="m-btn" onclick="closeS()">é–‰ã˜ã‚‹</button></div>

<script>
    let d = JSON.parse(localStorage.getItem('mofu_connect')) || {
        un:"", pn:"", cn:100, lvl:1, exp:0, kz:50, fd:50, myId: Math.floor(1000 + Math.random()*9000),
        eq:{head:"", handR:""}
    };
    let isVisiting = false;

    function init() {
        d.un = document.getElementById('u-in').value || "ã„ã£ãã‚“";
        d.pn = document.getElementById('p-in').value || "ãƒ¢ãƒ•";
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('my-id-display').innerText = d.myId;
        document.getElementById('my-id-show').innerText = d.myId;
        setupPetting();
        update();
        // è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å…¬é–‹ï¼ˆæ“¬ä¼¼ã‚µãƒ¼ãƒãƒ¼ç”¨ï¼‰
        saveToPublic();
    }
    if(d.un) init();

    function save() { 
        if(!isVisiting) {
            localStorage.setItem('mofu_connect', JSON.stringify(d)); 
            saveToPublic();
        }
    }

    // æ“¬ä¼¼çš„ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å…¬é–‹
    function saveToPublic() {
        let allData = JSON.parse(localStorage.getItem('mofu_network_hub') || '{}');
        allData[d.myId] = { un: d.un, pn: d.pn, lvl: d.lvl, eq: d.eq, kz: d.kz };
        localStorage.setItem('mofu_network_hub', JSON.stringify(allData));
    }

    function update() {
        document.getElementById('b-kz').style.width = d.kz+'%';
        document.getElementById('b-fd').style.width = d.fd+'%';
        document.getElementById('b-ex').style.width = (d.exp/(d.lvl*100))*100+'%';
        document.getElementById('coin-val').innerText = d.cn;
        document.getElementById('lv-badge').innerText = d.lvl;
        document.getElementById('mofu-name').innerText = d.pn + (isVisiting ? " (å‹é”ã®)" : "");
        document.getElementById('eq-head').innerText = d.eq.head;
        document.getElementById('eq-handR').innerText = d.eq.handR;
        save();
    }

    // --- é€šä¿¡ãŠã§ã‹ã‘æ©Ÿèƒ½ ---
    function visitFriend() {
        const fId = document.getElementById('friend-id-in').value;
        const allData = JSON.parse(localStorage.getItem('mofu_network_hub') || '{}');
        
        if(allData[fId]) {
            const fData = allData[fId];
            isVisiting = true;
            document.getElementById('visit-overlay').style.display = 'block';
            document.getElementById('target-name').innerText = fData.un;
            document.getElementById('mofu-area').style.background = "#e1f5fe"; // å‹é”ã®å®¶ã®è‰²
            document.getElementById('home-btn').style.display = 'block';
            
            // å‹é”ã®ãƒ¢ãƒ•ã‚’ä¸€æ™‚çš„ã«è¡¨ç¤º
            let tempPn = d.pn; d.pn = fData.pn;
            let tempEq = d.eq; d.eq = fData.eq;
            
            closeS();
            update();
            say(fData.un + "ã®éƒ¨å±‹ã«ããŸã‚ˆï¼");
        } else {
            alert("ãã®IDã®éƒ¨å±‹ã¯è¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã‚ˆâ€¦");
        }
    }

    function goHome() {
        location.reload(); // è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã«æˆ»ã‚‹ã®ãŒä¸€ç•ªç¢ºå®Ÿ
    }

    // --- ãªã§ãªã§ ---
    function setupPetting() {
        const target = document.getElementById('mofu-container');
        let isDown = false;
        const pet = (e) => {
            if(!isDown) return;
            let x = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            let y = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            spawnHeart(x, y);
            if(!isVisiting) d.kz = Math.min(100, d.kz + 0.2);
            update();
        };
        target.onmousedown = () => isDown = true;
        window.onmouseup = () => isDown = false;
        target.onmousemove = pet;
        target.ontouchmove = pet;
    }

    function spawnHeart(x, y) {
        const h = document.createElement('div');
        h.className = 'heart'; h.innerText = 'â¤ï¸';
        h.style.left = x + 'px'; h.style.top = y + 'px';
        document.getElementById('fx-layer').appendChild(h);
        setTimeout(() => h.remove(), 800);
    }

    function say(t) {
        let s = document.getElementById('speech');
        s.innerText = t; s.style.opacity = 1;
        setTimeout(() => s.style.opacity = 0, 2000);
    }

    function openS(id) { document.getElementById('s-'+id).classList.add('open'); }
    function closeS() { document.querySelectorAll('.sheet').forEach(s => s.classList.remove('open')); }
    function resetAll() { if(confirm("æœ€åˆã‹ã‚‰ã«ã™ã‚‹ï¼Ÿ")) { localStorage.clear(); location.reload(); } }
</script>
</body>
</html>
