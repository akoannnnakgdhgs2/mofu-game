<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ¢ãƒ•é€²åŒ–DX -Ultra-</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@900&display=swap');
        :root { --main: #5d4037; --sub: #efebe9; --acc: #ffab91; --win: #fff; --shadow: rgba(0,0,0,0.15); }
        body { margin: 0; height: 100vh; overflow: hidden; background: #fff8e1; font-family: 'Zen Maru Gothic', sans-serif; touch-action: none; user-select: none; -webkit-user-select: none; }
        
        /* ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼ˆè„±Googleã‚¢ãƒ©ãƒ¼ãƒˆï¼‰ */
        .custom-pop { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9); background: var(--win); border: 4px solid var(--main); border-radius: 30px; padding: 20px; width: 80%; max-width: 320px; text-align: center; z-index: 5000; box-shadow: 0 10px 30px rgba(0,0,0,0.3); opacity: 0; pointer-events: none; transition: 0.3s; }
        .custom-pop.show { opacity: 1; transform: translate(-50%, -50%) scale(1); pointer-events: auto; }
        .pop-title { font-size: 20px; color: #ff7043; margin-bottom: 10px; }
        
        /* UIãƒ‘ãƒ¼ãƒ„ */
        .ui-header { position: fixed; top: 10px; left: 10px; z-index: 100; pointer-events: none; }
        .status-box { background: rgba(255,255,255,0.9); padding: 10px 15px; border-radius: 20px; border: 3px solid var(--sub); pointer-events: auto; width: 160px; box-shadow: 0 4px 10px var(--shadow); backdrop-filter: blur(5px); }
        .status-row { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; font-size: 12px; font-weight: 900; color: var(--main); }
        .bar-bg { flex-grow: 1; height: 8px; background: #ddd; border-radius: 4px; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.5s ease-out; }
        
        .lv-badge { position: fixed; top: 15px; right: 15px; width: 70px; height: 70px; background: #fff; border: 4px solid #ffd700; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; box-shadow: 0 4px 10px var(--shadow); }
        
        /* ãƒ¢ãƒ•æœ¬ä½“ã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        #mofu-container { position: absolute; display: flex; flex-direction: column; align-items: center; z-index: 50; transition: left 3s ease-in-out, top 3s ease-in-out; }
        .mofu-body { width: 140px; height: 130px; background: #fff; border-radius: 50% 50% 45% 45%; border: 6px solid var(--sub); display: flex; justify-content: center; align-items: center; position: relative; cursor: pointer; transition: transform 0.2s, filter 0.3s; box-shadow: 0 8px 0 rgba(0,0,0,0.05); }
        
        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© */
        .anim-jump { animation: jump 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes jump { 0% { transform: scale(1); } 40% { transform: scale(0.9, 1.2) translateY(-50px); } 100% { transform: scale(1) translateY(0); } }
        
        .anim-shake { animation: shake 0.4s ease-in-out; }
        @keyframes shake { 0%,100%{transform:rotate(0deg);} 25%{transform:rotate(-10deg);} 75%{transform:rotate(10deg);} }
        
        .anim-sleep { transform: scale(0.95, 0.8) translateY(20px); filter: brightness(0.9); }
        
        .face { font-size: 45px; transition: 0.3s; }
        .slot { position: absolute; font-size: 50px; pointer-events: none; transition: 0.3s; }
        .slot-head { top: -45px; z-index: 10; }
        .slot-hand { right: -35px; top: 50px; transform: rotate(15deg); }
        
        /* ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .fx-particle { position: absolute; font-size: 24px; pointer-events: none; animation: floatUp 1.2s forwards; z-index: 200; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0) scale(0.5); } 100% { opacity: 0; transform: translateY(-80px) scale(1.5); } }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨ã‚·ãƒ¼ãƒˆ */
        .menu { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; z-index: 110; padding: 0 10px; box-sizing: border-box; }
        .btn { padding: 12px 18px; border-radius: 25px; border: none; background: white; font-weight: 900; color: var(--main); border-bottom: 5px solid var(--sub); cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.1s; font-size: 14px; }
        .btn:active { transform: translateY(4px); border-bottom-width: 0; }
        
        .sheet { position: fixed; bottom: -110%; left: 0; width: 100%; height: 80%; background: #fff; border-radius: 30px 30px 0 0; z-index: 400; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); padding: 25px; box-sizing: border-box; overflow-y: auto; box-shadow: 0 -10px 30px rgba(0,0,0,0.1); }
        .sheet.open { bottom: 0; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .overlay { position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; z-index:350; backdrop-filter: blur(2px); }

        /* ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ç”¨ */
        #game-area { display: none; flex-direction: column; align-items: center; width: 100%; height: 100%; }
        .game-target { font-size: 80px; margin: 20px; cursor: pointer; transition: 0.1s; }
        .game-target:active { transform: scale(0.8); }
        #gauge-box { width: 100%; height: 30px; background: #ddd; border-radius: 15px; position: relative; overflow: hidden; margin: 20px 0; }
        #gauge-bar { width: 10px; height: 100%; background: #ff7043; position: absolute; left: 0; }
        #gauge-zone { width: 40px; height: 100%; background: rgba(255,215,0,0.5); position: absolute; left: 50%; transform: translateX(-50%); border-left: 2px solid gold; border-right: 2px solid gold; }
    </style>
</head>
<body>

<div id="start-screen" style="position:fixed; inset:0; background:#fff8e1; z-index:3000; display:none; flex-direction:column; align-items:center; justify-content:center;">
    <h1 style="color:var(--main); margin-bottom:20px;">ãƒ¢ãƒ•é€²åŒ–DX</h1>
    <input type="text" id="un-in" style="padding:15px; border-radius:15px; border:3px solid var(--sub); width:70%; text-align:center; font-weight:bold;" placeholder="ãã¿ã®ãªã¾ãˆ">
    <input type="text" id="pn-in" style="padding:15px; margin:10px 0; border-radius:15px; border:3px solid var(--sub); width:70%; text-align:center; font-weight:bold;" placeholder="ãƒ¢ãƒ•ã®ãªã¾ãˆ">
    <button class="btn" style="background:var(--acc); color:white; width:50%;" onclick="initGame()">ã¯ã˜ã‚ã‚‹</button>
</div>

<div id="custom-pop" class="custom-pop">
    <h3 id="pop-title" class="pop-title">ãŠã—ã‚‰ã›</h3>
    <p id="pop-msg" style="color:#555; margin-bottom:20px; font-weight:bold;"></p>
    <button class="btn" onclick="closePop()" style="width:100%;">OK</button>
</div>

<div id="dark-fade" class="overlay" onclick="closeSheet()"></div>

<div class="ui-header">
    <div class="status-box">
        <div class="status-row">ğŸ’– ããšãª<div class="bar-bg"><div id="b-kizuna" class="bar-fill" style="background:#f06292;"></div></div></div>
        <div class="status-row">ğŸ™ ãŠãªã‹<div class="bar-bg"><div id="b-food" class="bar-fill" style="background:#ffb74d;"></div></div></div>
        <div class="status-row">ğŸ› ãã‚Œã„<div class="bar-bg"><div id="b-clean" class="bar-fill" style="background:#4fc3f7;"></div></div></div>
        <div class="status-row">ğŸ’¤ ã’ã‚“ã<div class="bar-bg"><div id="b-hp" class="bar-fill" style="background:#ba68c8;"></div></div></div>
        <div style="margin-top:8px; font-size:14px; font-weight:900; color:#ff8f00;">ğŸ’° <span id="coin">0</span> G</div>
    </div>
</div>

<div class="lv-badge">
    <div style="font-size:10px; color:var(--main);">Lv</div>
    <div id="v-lvl" style="font-size:26px; font-weight:900; color:var(--main);">1</div>
</div>

<div id="mofu-container">
    <div id="speech" style="position:absolute; top:-90px; background:white; border:3px solid var(--main); padding:8px 12px; border-radius:15px; opacity:0; font-weight:900; white-space:nowrap; transition:0.3s; pointer-events:none;"></div>
    
    <div id="s-head" class="slot slot-head"></div>
    <div id="s-hand" class="slot slot-hand"></div>
    
    <div id="my-mofu" class="mofu-body" onclick="petMofu()">
        <div id="my-face" class="face">ãƒ»â©Šãƒ»</div>
    </div>
    
    <div id="mofu-name" style="margin-top:10px; background:white; padding:3px 12px; border-radius:10px; border:2px solid var(--sub); font-size:12px; font-weight:bold;"></div>
</div>

<div class="menu">
    <button class="btn" onclick="openSheet('care-sheet')">ğŸ ãŠä¸–è©±</button>
    <button class="btn" onclick="openSheet('work-sheet')">âš’ï¸ ãƒã‚¤ãƒˆ</button>
    <button class="btn" onclick="openSheet('shop-sheet')">ğŸ›’ è²·ã„ç‰©</button>
    <button class="btn" onclick="openSheet('locker-sheet')">ğŸ‘— ããŒãˆ</button>
    <button class="btn" onclick="openSheet('comm-sheet')">ğŸ“¶ é€šä¿¡</button>
    <button class="btn" onclick="resetGame()" style="background:#ffccbc;">ğŸ”„</button>
</div>

<div id="care-sheet" class="sheet"><h3>âœ¨ ãŠä¸–è©±ã‚’ã™ã‚‹</h3><hr><div class="grid" id="care-list"></div><button class="btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">ã¨ã˜ã‚‹</button></div>
<div id="shop-sheet" class="sheet"><h3>ğŸ›’ ã‚¢ã‚¤ãƒ†ãƒ ã‚’è²·ã†</h3><hr><div class="grid" id="shop-list"></div><button class="btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">ã¨ã˜ã‚‹</button></div>
<div id="locker-sheet" class="sheet"><h3>ğŸ‘— ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ</h3><hr><div class="grid" id="locker-list"></div><button class="btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">ã¨ã˜ã‚‹</button></div>
<div id="comm-sheet" class="sheet"><h3>ğŸ“¶ é€šä¿¡ï¼ˆIDå…¥åŠ›ï¼‰</h3><hr><p>ãƒã‚¤ID: <span id="my-id">...</span></p><input id="p-id" placeholder="ç›¸æ‰‹ã®ID" style="padding:10px; width:100%;"><button class="btn" style="width:100%; margin-top:10px;">æ¥ç¶š</button><button class="btn" onclick="closeSheet()" style="width:100%; margin-top:20px;">ã¨ã˜ã‚‹</button></div>

<div id="work-sheet" class="sheet">
    <h3>âš’ï¸ ãƒã‚¤ãƒˆã‚’é¸ã¶</h3><hr>
    <div id="work-menu" class="grid"></div>
    
    <div id="game-area">
        <h2 id="g-title">é€£æ‰“ã—ã‚ï¼</h2>
        <div id="g-display" style="font-size:20px; font-weight:bold; margin-bottom:10px;">æ®‹ã‚Š: 10ç§’</div>
        
        <div id="tap-target" class="game-target" style="display:none;">ğŸ“¦</div>
        
        <div id="gauge-game" style="display:none; width:100%;">
            <div id="gauge-box"><div id="gauge-zone"></div><div id="gauge-bar"></div></div>
            <button class="btn" onclick="stopGauge()" style="width:100%; height:60px; font-size:20px; background:var(--acc); color:white;">ã‚¹ãƒˆãƒƒãƒ—ï¼</button>
        </div>
        
        <button class="btn" onclick="stopWork()" style="margin-top:auto; background:#ccc;">ã‚„ã‚ã‚‹</button>
    </div>
    <button class="btn" id="work-close" onclick="closeSheet()" style="width:100%; margin-top:20px;">ã¨ã˜ã‚‹</button>
</div>

<script>
    // ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–
    let d = JSON.parse(localStorage.getItem('mofu_ultra')) || { 
        un: "", pn: "", cn: 100, lvl: 1, exp: 0, 
        hp: 100, food: 100, clean: 100, kizuna: 0,
        items: [], eq: { head: "", hand: "" }
    };

    // ã‚²ãƒ¼ãƒ å¤‰æ•°
    let gameTimer, gaugeInterval, gaugePos = 0, gaugeDir = 1, tapCount = 0;

    // --- ã‚·ã‚¹ãƒ†ãƒ åŸºæœ¬ ---
    window.onload = () => {
        if(!d.un) document.getElementById('start-screen').style.display = 'flex';
        else startGame();
    };

    function initGame() {
        const u = document.getElementById('un-in').value;
        const p = document.getElementById('pn-in').value;
        if(!u || !p) return showPop("åå‰ã‚’ã„ã‚Œã¦ã­ï¼");
        d.un = u; d.pn = p;
        document.getElementById('start-screen').style.display = 'none';
        startGame();
    }

    function startGame() {
        document.getElementById('mofu-name').innerText = d.pn;
        updateUI();
        initPeer();
        setInterval(autoWalk, 4000);
        setInterval(() => { // ãŠè…¹ãŒæ¸›ã‚‹å‡¦ç†
            d.food = Math.max(0, d.food - 1);
            d.clean = Math.max(0, d.clean - 1);
            updateUI();
        }, 10000);
        updateLists(); // ãƒªã‚¹ãƒˆç”Ÿæˆ
    }

    function updateUI() {
        // ãƒãƒ¼æ›´æ–°
        ['kizuna','food','clean','hp'].forEach(k => {
            document.getElementById('b-'+k).style.width = d[k] + '%';
        });
        document.getElementById('coin').innerText = d.cn;
        document.getElementById('v-lvl').innerText = d.lvl;
        
        // è£…å‚™
        document.getElementById('s-head').innerText = d.eq.head;
        document.getElementById('s-hand').innerText = d.eq.hand;

        // è¡¨æƒ…å¤‰åŒ–ï¼ˆãŠè…¹ç©ºã„ãŸãƒ»çœ ã„ï¼‰
        const face = document.getElementById('my-face');
        if(d.hp < 20) face.innerText = "ï¼â©Šï¼"; // çœ ã„
        else if(d.food < 20) face.innerText = "ğŸ˜µ"; // ç©ºè…¹
        else face.innerText = "ãƒ»â©Šãƒ»"; // é€šå¸¸

        localStorage.setItem('mofu_ultra', JSON.stringify(d));
    }

    // --- ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼ˆè‡ªä½œï¼‰ ---
    function showPop(msg) {
        const p = document.getElementById('custom-pop');
        document.getElementById('pop-msg').innerText = msg;
        p.classList.add('show');
    }
    function closePop() { document.getElementById('custom-pop').classList.remove('show'); }

    // --- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ---
    function petMofu() {
        if(d.hp < 10) return showPop(d.pn+"ã¯çœ ã™ãã¦å‹•ã‘ãªã„...");
        addAnim('anim-jump');
        spawnFx("â¤ï¸");
        d.kizuna = Math.min(100, d.kizuna + 2);
        d.exp += 5;
        say(getRandom(["ãˆã¸ã¸ï¼", "ã‚‚ã£ã¨ï¼", "ã ã„ã™ãï¼"]));
        checkLv();
        updateUI();
    }

    function addAnim(cls) {
        const m = document.getElementById('my-mofu');
        m.classList.remove(cls);
        void m.offsetWidth; // ãƒªã‚»ãƒƒãƒˆæŠ€
        m.classList.add(cls);
    }

    function spawnFx(emoji) {
        const f = document.createElement('div');
        f.className = 'fx-particle';
        f.innerText = emoji;
        const m = document.getElementById('mofu-container');
        f.style.left = "50px"; f.style.top = "0px";
        m.appendChild(f);
        setTimeout(() => f.remove(), 1200);
    }

    function say(txt) {
        const s = document.getElementById('speech');
        s.innerText = txt; s.style.opacity = 1; s.style.top = "-90px";
        setTimeout(() => s.style.opacity = 0, 2500);
    }

    function checkLv() {
        if(d.exp >= d.lvl * 50) {
            d.lvl++; d.exp = 0;
            showPop(`ğŸ‰ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ Lv${d.lvl} ã«ãªã£ãŸï¼`);
            spawnFx("ğŸ†™");
        }
    }

    // --- ãŠä¸–è©±æ©Ÿèƒ½ ---
    const careItems = [
        {n:"ğŸš ã”ã¯ã‚“", type:"food", val:30, fx:"ğŸ™", msg:"ãŠã„ã—ã„ï¼"},
        {n:"ğŸ© ãŠã‚„ã¤", type:"food", val:10, fx:"ğŸ©", msg:"ã‚ã¾ã€œã„ï¼"},
        {n:"ğŸ¾ éŠã¶", type:"kizuna", val:15, fx:"ğŸ¾", msg:"ãŸã®ã—ã„ï¼"},
        {n:"ğŸš¿ ãŠé¢¨å‘‚", type:"clean", val:100, fx:"ğŸ›", msg:"ã•ã£ã±ã‚Šï¼"},
        {n:"ğŸ’¤ å¯ã‚‹", type:"hp", val:100, fx:"ğŸ’¤", msg:"ããƒ¼ã™ã‹..."},
        {n:"ğŸ–Œï¸ ãƒ–ãƒ©ã‚·", type:"clean", val:20, fx:"âœ¨", msg:"ã¤ã‚„ã¤ã‚„ã€œ"}
    ];

    function doCare(item) {
        if(item.n === "ğŸ’¤ å¯ã‚‹") {
            document.getElementById('my-mofu').classList.add('anim-sleep');
            document.getElementById('dark-fade').style.display='block';
            setTimeout(() => {
                d.hp = 100; updateUI(); 
                document.getElementById('my-mofu').classList.remove('anim-sleep');
                document.getElementById('dark-fade').style.display='none';
                showPop("ã‚ˆãå¯ã¦å…ƒæ°—ã„ã£ã±ã„ï¼");
            }, 3000);
        } else {
            d[item.type] = Math.min(100, d[item.type] + item.val);
            spawnFx(item.fx);
            say(item.msg);
            addAnim('anim-shake');
        }
        closeSheet();
        updateUI();
    }

    // --- ãƒã‚¤ãƒˆï¼ˆãƒŸãƒ‹ã‚²ãƒ¼ãƒ ï¼‰ ---
    function startWork(type) {
        const menu = document.getElementById('work-menu');
        const game = document.getElementById('game-area');
        const close = document.getElementById('work-close');
        
        menu.style.display = 'none';
        close.style.display = 'none';
        game.style.display = 'flex';
        
        let timeLeft = 10;
        document.getElementById('g-display').innerText = "æ®‹ã‚Š: 10ç§’";

        if(type === 'tap') {
            document.getElementById('g-title').innerText = "ç®±ã‚’é€£æ‰“ã—ã‚ï¼";
            document.getElementById('tap-target').style.display = 'block';
            document.getElementById('gauge-game').style.display = 'none';
            tapCount = 0;
            document.getElementById('tap-target').onclick = () => { tapCount++; spawnFx("ğŸ“¦"); };
        } else {
            document.getElementById('g-title').innerText = "ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚ˆãæ­¢ã‚ã‚ï¼";
            document.getElementById('tap-target').style.display = 'none';
            document.getElementById('gauge-game').style.display = 'block';
            gaugePos = 0;
            gaugeInterval = setInterval(() => {
                gaugePos += (2 * gaugeDir);
                if(gaugePos > 280 || gaugePos < 0) gaugeDir *= -1; // ç°¡æ˜“å¾€å¾©
                document.getElementById('gauge-bar').style.left = gaugePos + 'px';
            }, 10);
        }

        gameTimer = setInterval(() => {
            timeLeft--;
            document.getElementById('g-display').innerText = "æ®‹ã‚Š: " + timeLeft + "ç§’";
            if(timeLeft <= 0) {
                endWork(type, false);
            }
        }, 1000);
    }

    function stopGauge() { clearInterval(gaugeInterval); endWork('gauge', true); }

    function endWork(type, isManualStop) {
        clearInterval(gameTimer);
        let earned = 0;
        
        if(type === 'tap') {
            earned = tapCount * 5;
            showPop(`çµ‚äº†ï¼ ${tapCount}å€‹é‹ã‚“ã ï¼\nå ±é…¬: ${earned} G`);
        } else {
            // ã‚²ãƒ¼ã‚¸åˆ¤å®šï¼ˆçœŸã‚“ä¸­ã‚‰ã¸ã‚“130~170pxã‚ãŸã‚Šï¼‰
            if(gaugePos > 120 && gaugePos < 180) {
                earned = 300; showPop("å¤§æˆåŠŸï¼ãƒŠã‚¤ã‚¹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼\nå ±é…¬: 300 G");
            } else {
                earned = 50; showPop("ãŠã—ã„ï¼ã‚ºãƒ¬ã¡ã‚ƒã£ãŸ...\nå ±é…¬: 50 G");
            }
        }
        
        d.cn += earned;
        d.hp = Math.max(0, d.hp - 20); // ç–²ã‚Œã‚‹
        updateUI();
        stopWork();
    }

    function stopWork() {
        clearInterval(gameTimer); clearInterval(gaugeInterval);
        document.getElementById('game-area').style.display = 'none';
        document.getElementById('work-menu').style.display = 'grid';
        document.getElementById('work-close').style.display = 'block';
    }

    // --- UIåˆ¶å¾¡ ---
    function openSheet(id) { document.getElementById(id).classList.add('open'); document.getElementById('dark-fade').style.display='block'; }
    function closeSheet() { 
        document.querySelectorAll('.sheet').forEach(s=>s.classList.remove('open')); 
        document.getElementById('dark-fade').style.display='none'; 
        stopWork(); // ãƒã‚¤ãƒˆä¸­æ–­
    }
    
    function resetGame() {
        if(confirm("ã€é‡è¦ã€‘ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆã—ã¦æœ€åˆã‹ã‚‰ã«ã—ã¾ã™ã‹ï¼Ÿ")) {
            localStorage.removeItem('mofu_ultra');
            location.reload();
        }
    }
    function autoWalk() {
        const c = document.getElementById('mofu-container');
        const x = Math.random() * (window.innerWidth - 150);
        const y = Math.random() * (window.innerHeight - 300) + 100;
        c.style.left = x + 'px'; c.style.top = y + 'px';
    }
    function getRandom(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

    // --- ãƒªã‚¹ãƒˆç”Ÿæˆ ---
    function updateLists() {
        // ãŠä¸–è©±
        const cl = document.getElementById('care-list'); cl.innerHTML = "";
        careItems.forEach(i => {
            const b = document.createElement('button'); b.className = 'btn';
            b.innerText = i.n;
            b.onclick = () => doCare(i);
            cl.appendChild(b);
        });

        // ã‚·ãƒ§ãƒƒãƒ—
        const sl = document.getElementById('shop-list'); sl.innerHTML = "";
        const shop = [
            {n:"ğŸ‘‘ ç‹å† ", p:500, type:"head", val:"ğŸ‘‘"},
            {n:"ğŸ© ãƒãƒƒãƒˆ", p:300, type:"head", val:"ğŸ©"},
            {n:"ğŸ€ ãƒªãƒœãƒ³", p:150, type:"head", val:"ğŸ€"},
            {n:"ğŸ—¡ï¸ å‰£", p:1000, type:"hand", val:"ğŸ—¡ï¸"},
            {n:"ğŸª„ æ–", p:800, type:"hand", val:"ğŸª„"}
        ];
        shop.forEach(i => {
            const b = document.createElement('button'); b.className='btn';
            b.innerHTML = `${i.n}<br>ğŸ’°${i.p}`;
            b.onclick = () => {
                if(d.cn < i.p) return showPop("ãŠé‡‘ãŒè¶³ã‚Šãªã„ã‚ˆï¼ãƒã‚¤ãƒˆã—ã‚ˆã†ï¼");
                d.cn -= i.p;
                d.items.push(i);
                showPop(i.n + "ã‚’è²·ã£ãŸã‚ˆï¼\nã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆã‚’è¦‹ã¦ã­");
                updateLists(); updateUI();
            };
            sl.appendChild(b);
        });

        // ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ
        const ll = document.getElementById('locker-list'); ll.innerHTML = "";
        if(d.items.length === 0) ll.innerHTML = "<p style='grid-column:span 2; text-align:center;'>ã‹ã‚‰ã£ã½...</p>";
        d.items.forEach(i => {
            const b = document.createElement('button'); b.className='btn';
            b.innerText = i.n;
            b.onclick = () => { d.eq[i.type] = i.val; updateUI(); showPop("ããŒãˆãŸã‚ˆï¼"); };
            ll.appendChild(b);
        });

        // ãƒã‚¤ãƒˆ
        const wl = document.getElementById('work-menu'); wl.innerHTML = "";
        const jobs = [
            {n:"ğŸ“¦ é‹ã³å±‹ (é€£æ‰“)", type:"tap", lv:1},
            {n:"ğŸ¯ è­¦å‚™å“¡ (ç›®æŠ¼ã—)", type:"gauge", lv:3}
        ];
        jobs.forEach(j => {
            const b = document.createElement('button'); b.className='btn';
            b.innerHTML = `${j.n}<br><span style='font-size:10px'>Lv${j.lv}ä»¥ä¸Š</span>`;
            if(d.lvl < j.lv) { b.disabled = true; b.style.opacity = 0.5; }
            b.onclick = () => startWork(j.type);
            wl.appendChild(b);
        });
    }

    function initPeer() {
        const peer = new Peer();
        peer.on('open', id => document.getElementById('my-id').innerText = id);
    }
</script>
</body>
</html>
