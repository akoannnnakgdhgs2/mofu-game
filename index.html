<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ¢ãƒ•é€²åŒ–DX -Perfect-</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@900&display=swap');
        :root { --main: #5d4037; --sub: #efebe9; --acc: #ffab91; --win: #fff; --shadow: rgba(0,0,0,0.2); }
        body { margin: 0; height: 100vh; overflow: hidden; background: #fff8e1; font-family: 'Zen Maru Gothic', sans-serif; touch-action: none; user-select: none; -webkit-user-select: none; }

        /* UIãƒ‘ãƒ¼ãƒ„ */
        .ui-layer { position: fixed; z-index: 1000; pointer-events: none; width: 100%; height: 100%; }
        .status-box { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.95); padding: 8px 12px; border-radius: 15px; border: 3px solid var(--sub); pointer-events: auto; width: 140px; box-shadow: 0 4px 10px var(--shadow); }
        .bar-row { display: flex; align-items: center; gap: 5px; font-size: 11px; margin-bottom: 3px; font-weight: 900; color:var(--main); }
        .bar-bg { flex: 1; height: 6px; background: #ddd; border-radius: 3px; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.5s; }
        
        .coin-box { position: absolute; top: 10px; right: 80px; font-weight: 900; color: #ff8f00; background: white; padding: 5px 10px; border-radius: 20px; border: 2px solid var(--sub); pointer-events: auto; }
        .lv-badge { position: absolute; top: 10px; right: 10px; width: 60px; height: 60px; background: white; border: 4px solid gold; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: auto; box-shadow: 0 4px 5px var(--shadow); }

        /* ãƒ¢ãƒ•æœ¬ä½“ */
        #mofu-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); transition: left 0.5s, top 0.5s; z-index: 50; width: 140px; height: 140px; }
        .mofu-body { width: 100%; height: 100%; background: #fff; border-radius: 50% 50% 45% 45%; border: 6px solid var(--sub); display: flex; justify-content: center; align-items: center; position: relative; cursor: pointer; transition: transform 0.1s; box-shadow: 0 10px 0 rgba(0,0,0,0.1); }
        .mofu-body:active { transform: scale(0.95) translateY(5px); box-shadow: 0 2px 0 rgba(0,0,0,0.1); } /* ã‚€ã«ã‚…ã‚“æ„Ÿ */
        
        .face { font-size: 45px; z-index: 20; }
        .equip-item { position: absolute; font-size: 50px; z-index: 25; pointer-events: none; transition: 0.2s; white-space: nowrap; }

        /* ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆãŠé¢¨å‘‚ãƒ»å¯ã‚‹ãªã©ï¼‰ */
        #fx-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 500; display: none; overflow: hidden; }
        .bubble { position: absolute; background: rgba(255,255,255,0.8); border-radius: 50%; animation: floatUp 3s linear infinite; }
        .shower-line { position: absolute; background: rgba(100,200,255,0.5); width: 2px; height: 50px; animation: rain 0.5s linear infinite; }
        .dark-mask { background: rgba(0,0,0,0.7); position: absolute; inset: 0; }
        
        @keyframes floatUp { 0%{transform:translateY(100vh) scale(0.5);} 100%{transform:translateY(-10vh) scale(1.2);} }
        @keyframes rain { 0%{transform:translateY(-50px);} 100%{transform:translateY(100vh);} }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
        .menu-bar { position: fixed; bottom: 15px; width: 100%; display: flex; justify-content: center; gap: 8px; z-index: 2000; flex-wrap: wrap; padding: 0 5px; }
        .m-btn { padding: 10px 15px; border-radius: 20px; border: none; background: white; border-bottom: 4px solid var(--sub); font-weight: bold; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .m-btn:active { transform: translateY(4px); border-bottom: 0; }
        
        /* ã‚·ãƒ¼ãƒˆï¼ˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰ */
        .sheet { position: fixed; bottom: -110%; left: 0; width: 100%; height: 85%; background: white; border-radius: 25px 25px 0 0; z-index: 3000; transition: 0.3s; padding: 20px; box-sizing: border-box; overflow-y: auto; box-shadow: 0 -5px 20px rgba(0,0,0,0.2); display: flex; flex-direction: column; }
        .sheet.open { bottom: 0; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .close-btn { margin-top: auto; padding: 15px; background: #eee; border: none; border-radius: 15px; font-weight: bold; width: 100%; cursor: pointer; }
        .sheet-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2500; display: none; backdrop-filter: blur(2px); }

        /* åå‰å…¥åŠ›ç”»é¢ */
        #start-screen { position: fixed; inset: 0; background: #fff8e1; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
        .pop { position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%) scale(0.8); background: white; padding: 20px; border-radius: 20px; border: 4px solid var(--main); text-align: center; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 6000; width: 80%; max-width: 300px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .pop.show { opacity: 1; transform: translate(-50%,-50%) scale(1); pointer-events: auto; }

        /* ãƒã‚¤ãƒˆã‚²ãƒ¼ãƒ ç”¨ */
        #game-view { display: none; height: 100%; flex-direction: column; align-items: center; justify-content: center; }
        .game-btn { width: 100px; height: 100px; border-radius: 50%; border: none; background: #ff7043; color: white; font-size: 30px; font-weight: bold; box-shadow: 0 8px #d84315; cursor: pointer; margin: 20px; }
        .game-btn:active { box-shadow: 0 2px #d84315; transform: translateY(6px); }

        /* ä½ç½®èª¿æ•´ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ */
        #pos-ctrl { display: none; padding: 10px; background: #f5f5f5; border-radius: 10px; margin-bottom: 10px; text-align: center; }
        .pos-btn { width: 40px; height: 40px; border-radius: 5px; border: 1px solid #ccc; background: white; font-size: 20px; }
    </style>
</head>
<body>

<div id="start-screen">
    <h1 style="color:var(--main);">ãƒ¢ãƒ•é€²åŒ–DX</h1>
    <p>ç©¶æ¥µç‰ˆ</p>
    <input id="in-un" placeholder="ãã¿ã®ãªã¾ãˆ" style="padding:10px; margin:5px; text-align:center; border-radius:10px; border:2px solid #ccc;">
    <input id="in-pn" placeholder="ãƒ¢ãƒ•ã®ãªã¾ãˆ" style="padding:10px; margin:5px; text-align:center; border-radius:10px; border:2px solid #ccc;">
    <button class="m-btn" style="background:var(--acc); color:white; width:150px; margin-top:20px;" onclick="initGame()">ã¯ã˜ã‚ã‚‹</button>
</div>

<div class="ui-layer">
    <div class="status-box">
        <div class="bar-row">ğŸ’–<div class="bar-bg"><div id="b-kizuna" class="bar-fill" style="background:#e91e63;"></div></div></div>
        <div class="bar-row">ğŸ™<div class="bar-bg"><div id="b-food" class="bar-fill" style="background:#ff9800;"></div></div></div>
        <div class="bar-row">ğŸš¿<div class="bar-bg"><div id="b-clean" class="bar-fill" style="background:#03a9f4;"></div></div></div>
        <div class="bar-row">ğŸ’¤<div class="bar-bg"><div id="b-hp" class="bar-fill" style="background:#9c27b0;"></div></div></div>
    </div>
    <div class="coin-box">ğŸ’° <span id="v-coin">0</span></div>
    <div class="lv-badge"><div>Lv</div><div id="v-lv" style="font-size:20px; font-weight:900;">1</div></div>
</div>

<div id="mofu-container">
    <div class="mofu-body" id="mofu-body" onclick="petMofu()">
        <div id="face" class="face">ãƒ»â©Šãƒ»</div>
        <div id="eq-head" class="equip-item" style="top:-40px;"></div>
        <div id="eq-face" class="equip-item" style="top:10px;"></div>
        <div id="eq-handR" class="equip-item" style="right:-30px; top:50px;"></div>
        <div id="eq-handL" class="equip-item" style="left:-30px; top:50px;"></div>
        <div id="eq-back" class="equip-item" style="top:-20px; left:-40px; z-index:-1; font-size:80px; opacity:0.5;"></div>
    </div>
    <div id="chat-bubble" style="position:absolute; top:-80px; background:white; padding:5px 10px; border-radius:10px; border:2px solid var(--main); opacity:0; transition:0.3s; white-space:nowrap; font-weight:bold; pointer-events:none;"></div>
</div>

<div id="fx-overlay"></div>

<div class="menu-bar">
    <button class="m-btn" onclick="openSheet('care')">ğŸ–ï¸ ãŠä¸–è©±</button>
    <button class="m-btn" onclick="openSheet('work')">âš’ï¸ ãƒã‚¤ãƒˆ</button>
    <button class="m-btn" onclick="openSheet('shop')">ğŸ›’ åº—</button>
    <button class="m-btn" onclick="openSheet('equip')">ğŸ’ è£…å‚™</button>
    <button class="m-btn" onclick="openSheet('comm')">ğŸ“¶ é€šä¿¡</button>
    <button class="m-btn" onclick="confirmReset()" style="background:#ffccbc;">ğŸ—‘ï¸</button>
</div>

<div class="sheet-overlay" id="overlay" onclick="closeSheet()"></div>

<div id="sheet-care" class="sheet">
    <h3>ğŸ–ï¸ ãŠä¸–è©±ã‚’ã™ã‚‹</h3><hr>
    <div class="grid" id="list-care"></div>
    <button class="close-btn" onclick="closeSheet()">ã¨ã˜ã‚‹</button>
</div>

<div id="sheet-work" class="sheet">
    <h3>âš’ï¸ ãƒã‚¤ãƒˆã§ç¨¼ã</h3><hr>
    <div id="list-work" class="grid"></div>
    <div id="game-view">
        <h2 id="g-msg">é€£æ‰“ã—ã‚ï¼</h2>
        <div id="g-timer" style="font-size:24px; font-weight:bold;">æ®‹ã‚Š 10ç§’</div>
        <button id="g-action" class="game-btn">ğŸ“¦</button>
        <div id="g-gauge" style="width:80%; height:20px; background:#ddd; border-radius:10px; position:relative; overflow:hidden; display:none; margin:20px;">
            <div id="g-bar" style="width:10px; height:100%; background:red; position:absolute;"></div>
            <div style="position:absolute; left:45%; width:10%; height:100%; background:rgba(255,215,0,0.5); border-left:2px solid gold; border-right:2px solid gold;"></div>
        </div>
        <button class="m-btn" onclick="stopWork()">ã‚„ã‚ã‚‹</button>
    </div>
    <button class="close-btn" onclick="closeSheet()">ã¨ã˜ã‚‹</button>
</div>

<div id="sheet-shop" class="sheet"><h3>ğŸ›’ ãŠåº—</h3><hr><div class="grid" id="list-shop"></div><button class="close-btn" onclick="closeSheet()">ã¨ã˜ã‚‹</button></div>

<div id="sheet-equip" class="sheet">
    <h3>ğŸ’ æŒã¡ç‰©ãƒ»è£…å‚™</h3>
    <p style="font-size:12px;">ã‚¢ã‚¤ãƒ†ãƒ ã‚’é¸ã‚“ã§ã€çŸ¢å°ã§ä½ç½®ã‚’èª¿æ•´ã§ãã‚‹ã‚ˆï¼</p>
    <div id="pos-ctrl">
        é¸æŠä¸­: <span id="cur-edit">ãªã—</span><br>
        <button class="pos-btn" onclick="moveEq(0,-5)">â¬†</button><br>
        <button class="pos-btn" onclick="moveEq(-5,0)">â¬…</button>
        <button class="pos-btn" onclick="moveEq(5,0)">â¡</button><br>
        <button class="pos-btn" onclick="moveEq(0,5)">â¬‡</button>
    </div>
    <hr>
    <div class="grid" id="list-equip"></div>
    <button class="close-btn" onclick="closeSheet()">ã¨ã˜ã‚‹</button>
</div>

<div id="sheet-comm" class="sheet">
    <h3>ğŸ“¶ é€šä¿¡ãƒ¢ãƒ¼ãƒ‰</h3><hr>
    <p>ãƒã‚¤ID: <span id="my-id" style="background:#eee; padding:5px;">...</span></p>
    <input id="peer-id" placeholder="ç›¸æ‰‹ã®ID" style="width:100%; padding:10px; margin-bottom:10px;">
    <button class="m-btn" style="width:100%; background:#03a9f4; color:white;" onclick="connectPeer()">æ¥ç¶šã™ã‚‹</button>
    <button class="close-btn" onclick="closeSheet()">ã¨ã˜ã‚‹</button>
</div>

<div id="pop" class="pop"><h3 id="pop-t"></h3><p id="pop-m"></p><button class="m-btn" onclick="hidePop()">OK</button></div>

<script>
    // --- ãƒ‡ãƒ¼ã‚¿ç®¡ç† ---
    let d = JSON.parse(localStorage.getItem('mofu_perfect')) || {
        un:"", pn:"", cn:100, lvl:1, exp:0,
        kizuna:50, food:50, clean:50, hp:100,
        items:[], 
        eq:{ head:"", face:"", handR:"", handL:"", back:"" },
        pos:{ head:{x:0,y:-40}, face:{x:0,y:10}, handR:{x:45,y:50}, handL:{x:-45,y:50}, back:{x:-40,y:-20} }
    };

    let walkTimer;
    let isSleeping = false;
    let editingSlot = null;

    // --- åˆæœŸåŒ– ---
    window.onload = () => {
        if(d.un) startGame();
        else document.getElementById('start-screen').style.display='flex';
    };

    function initGame(){
        d.un = document.getElementById('in-un').value || "ã„ã£ãã‚“";
        d.pn = document.getElementById('in-pn').value || "ãƒ¢ãƒ•";
        document.getElementById('start-screen').style.display='none';
        startGame();
    }

    function startGame(){
        updateUI();
        initPeer();
        startWalk();
        setInterval(() => { if(!isSleeping){ d.food=Math.max(0,d.food-1); d.clean=Math.max(0,d.clean-1); updateUI(); } }, 8000);
    }

    function saveData(){ localStorage.setItem('mofu_perfect', JSON.stringify(d)); }

    function updateUI(){
        ['kizuna','food','clean','hp'].forEach(k => document.getElementById('b-'+k).style.width = d[k]+'%');
        document.getElementById('v-coin').innerText = d.cn;
        document.getElementById('v-lv').innerText = d.lvl;
        
        // è£…å‚™åæ˜ 
        for(let s in d.eq){
            const el = document.getElementById('eq-'+s);
            el.innerText = d.eq[s];
            if(d.pos[s]) {
                el.style.transform = `translate(${d.pos[s].x}px, ${d.pos[s].y}px)`;
            }
        }
        
        // è¡¨æƒ…
        const f = document.getElementById('face');
        if(isSleeping) f.innerText = "ï¼â©Šï¼";
        else if(d.kizuna > 80) f.innerText = "ï¼¾â©Šï¼¾";
        else if(d.food < 20) f.innerText = "ğŸ˜µ";
        else f.innerText = "ãƒ»â©Šãƒ»";

        saveData();
    }

    // --- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ---
    function petMofu(){
        if(isSleeping) return showPop("å¯ã¦ã‚‹ã‚ˆ","èµ·ã“ã•ãªã„ã§ã‚ã’ã¦ã­");
        d.kizuna = Math.min(100, d.kizuna+2); d.exp+=5;
        spawnHeart();
        say(d.un+"ã€ã ã„ã™ãï¼");
        checkLv(); updateUI();
    }
    
    function spawnHeart(){
        const h = document.createElement('div'); h.innerText="â¤ï¸"; 
        h.style.position="absolute"; h.style.left="50%"; h.style.top="50%";
        h.style.fontSize="30px"; h.style.pointerEvents="none";
        h.animate([{transform:'translate(-50%,-50%) scale(0.5)', opacity:1}, {transform:'translate(-50%,-150px) scale(1.5)', opacity:0}], {duration:1000});
        document.getElementById('mofu-container').appendChild(h);
        setTimeout(()=>h.remove(),1000);
    }

    function say(t){
        const b = document.getElementById('chat-bubble');
        b.innerText = t; b.style.opacity=1; b.style.top="-90px";
        setTimeout(()=>b.style.opacity=0, 2500);
    }

    function startWalk(){
        if(walkTimer) clearInterval(walkTimer);
        walkTimer = setInterval(()=>{
            if(isSleeping) return;
            const c = document.getElementById('mofu-container');
            const x = Math.random()*(window.innerWidth-160)+80;
            const y = Math.random()*(window.innerHeight-300)+100;
            c.style.left = x+"px"; c.style.top = y+"px";
        }, 4000);
    }

    // --- ãŠä¸–è©±ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ ---
    function doCare(type, val, name){
        closeSheet();
        if(type === 'sleep'){
            isSleeping = true;
            document.body.style.background = "#263238"; // å¤œ
            const fx = document.getElementById('fx-overlay');
            fx.style.display='block'; fx.innerHTML = '<div class="dark-mask"></div><div style="position:absolute;top:20%;left:50%;color:white;font-size:40px;">ğŸ’¤</div>';
            say("ãŠã‚„ã™ã¿...");
            updateUI();
            setTimeout(()=>{
                d.hp=100; isSleeping=false; 
                document.body.style.background = "#fff8e1";
                fx.style.display='none'; fx.innerHTML="";
                say("ã‚ˆãå¯ãŸã€œï¼"); updateUI();
            }, 4000);
            return;
        }

        if(type === 'bath'){
            const fx = document.getElementById('fx-overlay');
            fx.style.display='block';
            for(let i=0; i<20; i++){
                const b = document.createElement('div'); b.className='bubble';
                b.style.left=Math.random()*100+'%'; b.style.width=Math.random()*30+10+'px'; b.style.height=b.style.width;
                b.style.animationDuration = Math.random()*2+2+'s';
                fx.appendChild(b);
            }
            // ã‚·ãƒ£ãƒ¯ãƒ¼
            for(let i=0; i<10; i++){
                const s = document.createElement('div'); s.className='shower-line';
                s.style.left=Math.random()*100+'%'; s.style.animationDelay=Math.random()+'s';
                fx.appendChild(s);
            }
            say("ã”ãã‚‰ãã”ãã‚‰ãã€œâ™¨ï¸");
            setTimeout(()=>{ fx.style.display='none'; fx.innerHTML=""; }, 3000);
            d.clean = 100;
        } 
        else if(type === 'play'){
            // ãƒœãƒ¼ãƒ«éŠã³
            const ball = document.createElement('div');
            ball.innerText = "ğŸ¾"; ball.style.position="fixed"; ball.style.fontSize="40px"; ball.style.zIndex="1000";
            document.body.appendChild(ball);
            ball.animate([
                {transform:'translate(10vw, 80vh)'}, {transform:'translate(50vw, 20vh)'}, {transform:'translate(90vw, 80vh)'}
            ], {duration:1000, iterations:2, direction:"alternate"});
            setTimeout(()=>ball.remove(), 2000);
            d.kizuna = Math.min(100, d.kizuna+val);
            say("ã‚ãƒ¼ã„ï¼");
        }
        else {
            // ã”ã¯ã‚“ãªã©
            d[type] = Math.min(100, d[type]+val);
            say(name+"ã€ãŠã„ã—ã„ï¼");
        }
        updateUI();
    }

    // --- ãƒã‚¤ãƒˆã‚·ã‚¹ãƒ†ãƒ  ---
    let gameInt, gTimer, gTarget;
    function startJob(lv, rew, type){
        if(d.lvl < lv) return showPop("ãƒ¬ãƒ™ãƒ«ä¸è¶³","Lv"+lv+"ã«ãªã£ãŸã‚‰ã§ãã‚‹ã‚ˆ");
        document.getElementById('list-work').style.display='none';
        document.getElementById('game-view').style.display='flex';
        
        let t = 10;
        let score = 0;
        const btn = document.getElementById('g-action');
        const gauge = document.getElementById('g-gauge');
        const title = document.getElementById('g-msg');
        
        document.getElementById('g-timer').innerText = "æ®‹ã‚Š "+t+"ç§’";
        
        if(type === 'tap'){
            title.innerText = "ç®±ã‚’é€£æ‰“ã—ã‚ï¼";
            btn.style.display='block'; gauge.style.display='none'; btn.innerText="ğŸ“¦";
            btn.onclick = () => { score++; btn.style.transform="scale(0.9)"; setTimeout(()=>btn.style.transform="scale(1)",50); };
        } else if(type === 'timing'){
            title.innerText = "çœŸã‚“ä¸­ã§æ­¢ã‚ã‚ï¼";
            btn.style.display='block'; gauge.style.display='block'; btn.innerText="STOP";
            let pos = 0; let dir = 2;
            gameInt = setInterval(()=>{
                pos += dir; if(pos>100||pos<0) dir*=-1;
                document.getElementById('g-bar').style.left = pos+"%";
            }, 20);
            btn.onclick = () => {
                clearInterval(gameInt);
                if(pos>40 && pos<60) score=10; else score=1;
                t=0; // å³çµ‚äº†
            };
        }

        gTimer = setInterval(()=>{
            t--;
            document.getElementById('g-timer').innerText = "æ®‹ã‚Š "+t+"ç§’";
            if(t<=0){
                clearInterval(gTimer); clearInterval(gameInt);
                let get = 0;
                if(type==='tap') get = score * 10;
                if(type==='timing') get = score * 50;
                
                d.cn += get; d.hp -= 20; d.exp += 20;
                showPop("ãƒã‚¤ãƒˆçµ‚äº†ï¼", get+"G ç¨¼ã„ã ï¼");
                updateUI(); stopWork();
            }
        }, 1000);
    }
    
    function stopWork(){
        clearInterval(gTimer); clearInterval(gameInt);
        document.getElementById('game-view').style.display='none';
        document.getElementById('list-work').style.display='grid';
    }

    // --- è£…å‚™ç·¨é›† ---
    function editPos(slot){
        editingSlot = slot;
        document.getElementById('cur-edit').innerText = slot;
        document.getElementById('pos-ctrl').style.display='block';
    }
    function moveEq(x,y){
        if(!editingSlot) return;
        if(!d.pos[editingSlot]) d.pos[editingSlot] = {x:0, y:0};
        d.pos[editingSlot].x += x;
        d.pos[editingSlot].y += y;
        updateUI();
    }

    // --- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”Ÿæˆ ---
    function openSheet(id){
        document.querySelectorAll('.sheet').forEach(s=>s.classList.remove('open'));
        document.getElementById('overlay').style.display='block';
        document.getElementById('sheet-'+id).classList.add('open');
        refreshLists();
    }
    function closeSheet(){
        document.querySelectorAll('.sheet').forEach(s=>s.classList.remove('open'));
        document.getElementById('overlay').style.display='none';
        stopWork();
    }

    function refreshLists(){
        // ãŠä¸–è©±ãƒªã‚¹ãƒˆ
        const cl = document.getElementById('list-care'); cl.innerHTML="";
        [
            {n:"ğŸ™ãŠã«ãã‚Š",t:"food",v:30}, {n:"ğŸ–ãŠè‚‰",t:"food",v:50}, 
            {n:"ğŸ°ã‚±ãƒ¼ã‚­",t:"food",v:80}, {n:"ğŸ›€ãŠé¢¨å‘‚",t:"bath",v:100},
            {n:"ğŸ¾éŠã¶",t:"play",v:20}, {n:"ğŸ’¤å¯ã‚‹",t:"sleep",v:100}
        ].forEach(i=>{
            const b = document.createElement('button'); b.className='m-btn'; b.innerText=i.n;
            b.onclick = ()=>doCare(i.t, i.v, i.n);
            cl.appendChild(b);
        });

        // ã‚·ãƒ§ãƒƒãƒ—ãƒªã‚¹ãƒˆ (å¤§é‡è¿½åŠ )
        const sl = document.getElementById('list-shop'); sl.innerHTML="";
        const items = [
            {n:"ğŸ‘‘ç‹å† ",p:500,s:"head",v:"ğŸ‘‘"}, {n:"ğŸ©ãƒãƒƒãƒˆ",p:300,s:"head",v:"ğŸ©"}, {n:"ğŸ§¢ã‚­ãƒ£ãƒƒãƒ—",p:150,s:"head",v:"ğŸ§¢"},
            {n:"ğŸ€ãƒªãƒœãƒ³",p:100,s:"head",v:"ğŸ€"}, {n:"ğŸ‘“ãƒ¡ã‚¬ãƒ",p:200,s:"face",v:"ğŸ‘“"}, {n:"ğŸ•¶ã‚°ãƒ©ã‚µãƒ³",p:250,s:"face",v:"ğŸ•¶"},
            {n:"ğŸ˜·ãƒã‚¹ã‚¯",p:50,s:"face",v:"ğŸ˜·"}, {n:"ğŸ—¡å‰£",p:1000,s:"handR",v:"ğŸ—¡"}, {n:"ğŸ›¡ç›¾",p:800,s:"handL",v:"ğŸ›¡"},
            {n:"ğŸª„æ–",p:600,s:"handR",v:"ğŸª„"}, {n:"ğŸ”®ç‰",p:500,s:"handL",v:"ğŸ”®"}, {n:"ğŸ’ãƒªãƒ¥ãƒƒã‚¯",p:400,s:"back",v:"ğŸ’"},
            {n:"ğŸª½ç¿¼",p:2000,s:"back",v:"ğŸª½"}, {n:"ğŸ¸ã‚®ã‚¿ãƒ¼",p:1200,s:"back",v:"ğŸ¸"}
        ];
        items.forEach(i=>{
            const b = document.createElement('button'); b.className='m-btn'; b.innerHTML=`${i.n}<br>ğŸ’°${i.p}`;
            b.onclick = ()=>{
                if(d.cn < i.p) return showPop("é‡‘æ¬ ï¼","ãŠé‡‘ãŒè¶³ã‚Šãªã„ã‚ˆ");
                d.cn -= i.p; d.items.push(i); showPop("è³¼å…¥ï¼","è£…å‚™ç”»é¢ã‚’è¦‹ã¦ã­"); updateUI();
            };
            sl.appendChild(b);
        });

        // è£…å‚™ãƒªã‚¹ãƒˆ
        const el = document.getElementById('list-equip'); el.innerHTML="";
        d.items.forEach(i=>{
            const b = document.createElement('button'); b.className='m-btn'; b.innerText=i.n;
            b.onclick = ()=>{ d.eq[i.s] = i.v; updateUI(); editPos(i.s); };
            el.appendChild(b);
        });

        // ãƒã‚¤ãƒˆãƒªã‚¹ãƒˆ
        const wl = document.getElementById('list-work'); wl.innerHTML="";
        [
            {n:"æƒé™¤",l:1,r:50,t:'tap'}, {n:"çš¿æ´—ã„",l:2,r:80,t:'tap'}, 
            {n:"å¼•è¶Šã—",l:4,r:150,t:'tap'}, {n:"è­¦å‚™",l:5,r:300,t:'timing'},
            {n:"å‹‡è€…",l:10,r:1000,t:'timing'}
        ].forEach(w=>{
            const b = document.createElement('button'); b.className='m-btn'; b.innerHTML=`${w.n}<br>Lv${w.l} / ğŸ’°${w.r}`;
            if(d.lvl < w.l) b.style.opacity=0.5;
            b.onclick = ()=>startJob(w.l, w.r, w.t);
            wl.appendChild(b);
        });
    }

    function checkLv(){ if(d.exp > d.lvl*50){ d.lvl++; d.exp=0; showPop("ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼","Lv"+d.lvl+"ã«ãªã£ãŸï¼"); } }
    
    function showPop(t,m){ document.getElementById('pop-t').innerText=t; document.getElementById('pop-m').innerText=m; document.getElementById('pop').classList.add('show'); }
    function hidePop(){ document.getElementById('pop').classList.remove('show'); }
    function confirmReset(){ if(confirm("ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆã—ã¦æœ€åˆã‹ã‚‰ã‚„ã‚‹ï¼Ÿ")){ localStorage.removeItem('mofu_perfect'); location.reload(); } }

    function initPeer(){
        const peer = new Peer();
        peer.on('open', id => document.getElementById('my-id').innerText = id);
        peer.on('connection', c => { c.on('data', data => showPop("é€šä¿¡", data)); });
    }
    function connectPeer(){
        const id = document.getElementById('peer-id').value;
        if(!id) return;
        showPop("æ¥ç¶šä¸­", id+"ã‚’æ¢ã—ã¦ã„ã¾ã™...");
    }
</script>
</body>
</html>
